---
title: 《区块链原理、设计与应用》读书摘要
date: 2018-04-03 14:41:06
tags: 区块链
---
实验室项目需要了解区块链的有关原理和技术，将自己的读书摘要记录到此处
一、技术核心概览
---
**定义与原理**
中本聪：区块链是用于记录比特币交易账目历史的数据结构
Wikipedia：将区块链类比为一种分布式数据库技术，通过维护数据快的链式结构，维持持续增长的、不可篡改的数据记录
<!-- more-->
**基本原理**
交易transaction：一次对账本的操作，导致账本状态的一次改变
区块block：计算一段时间内发生的所有交易和状态结果，是对当前账本状态的一次共识
链chain：由区块按照发生顺序串联而成，是整个账本状态变化的日志记录

假设存在一个分布式账本，只允许添加、不允许删除。账本底层是数据结构一个线性链表，链表由一个个区块串联而成，后继区块记录前导区块的Hash值，新数据要加入，必须放到一个新的区块中，而这个块是否合法，可以通过计算哈希值的方式快速检验出来
工作量证明PoW:基于算力寻找nonce串的共识机制

**技术演化和分类**
智能合约smart contract:提供除了货币交易外更灵活的合约功能，执行更复杂的操作

基于区块链的分布式账本特点：
1.维护一条不断增长的链，只能添加记录，发生过的记录不可修改
2.去中心化，或多中心化，无需集中控制而能达成共识，实现上尽量采用分布式
3.通过密码学的机制确保交易无法被抵赖和破坏，尽量保护用户信息和记录的隐私性

*分类*：
* 公有链; 任何人可以参与使用和维护
 *进一步引入许可机制，可实现：*
* 私有链：由集中管理者进行管理限制，只有少数人可以使用，信息不公开
* 联盟链：介于其他两者之间，有若干组织一起维护一条区块链，该区块链的使用必须带有权限的限制访问，相关信息会得到保护，如供应链或银行联盟

二、分布式系统核心问题
---
**一致性问题**
*一致性*指对于分布式系统中的多个服务节点，给定一系列操作，在约定协议的保障下，试图使得他们对处理结果达成“某种程度”的认同
*一致性要求*：
1.可终止性：一致的结果能在有限时间内完成
2.约同性：不同节点最终完成决策的结果是相同的
3.合法性：决策的结果必须是某个节点提出的提案
**共识算法**
共识算法解决的是对某个提案大家达成一致意见的过程
非拜占庭错误：出现错误但不会伪造信息的情况
拜占庭错误：伪造信息恶意响应的情况，对应节点为拜占庭节点
共识算法：
解决非拜占庭错误CTF：Paxos、Paft等
解决拜占庭错误BFT：pbft,PoW等
**FLP不可能原理**
在网络可靠，但允许节点失败的最小化异步模型系统中，不存在一個可以解决一致性问题的确定性共识算法
**CAP原理**
分布式计算系统不可能同时确保三个特性：一致性、可用性和分区容忍性，设计中往往需要弱化对某个特性的保证。
> 一致性：任何操作都是原子的，发生在后面的事件能看到前面时间发生导致的结果
> 可用性：在有限时间内，任何非失败节点都能应答请求
> 分区容忍性：网络可能发生分区，节点之间通信不可保障

**Paxos算法**
基于“两阶段提交“算法并进行泛化扩展，基本原理是将节点分为三种逻辑角色，在实现上一个人可以担任多个角色：
* Proposer提案者：提树一个提案，等待大家批准为结案，一般客户端担任此角色
* Accepter接受者：负责对提案进行投票，接受提案，一般服务器担任此角色
* Learner学习者：获取批准结果，并帮忙传播，不参与投票过程，可能为客户端或者服务器端

*算法约束*：
- Safey约束:保证决议是对的，无歧义的，不会出现错误情况
- LIveness约束：保证决议过程能在有限时间内完成

*两阶段提交*
准备阶段：
> 1. 提案者发送自己计划提交的提案的编号到多个接受者，试探是否可以锁定多个接收者的支持。
> 2. 接受者时刻保留收到过的提案的最大编号和接受的最大提案，如果收到的提案号比目前保留的最大的提案号还大，更新当前最大提案号，并说明不再接受小于最大提案号的提案

提交阶段：
> 1.提案者如果收到大多数的回复，则可准备发出带有刚才提案号的接受消息。如果收到的回复中不带有新的提案，说明锁定成功。则使用自己的提案内容，如果返回中有提案内容，则替换提案值为返回中编号最大的提案值。如果没有收到足够的回复，则需要再次发出请求。
>
> 2. 接受者收到”接受消息“后，如果发现提案号不小于已接受的最大提案号，则接受该提案，并更新接受的最大提案。

**Raft算法**
　在Raft中，任何时候一个服务器可以扮演下面角色之一：

    Leader: 处理所有客户端交互，日志复制等，一般一次只有一个Leader.
    Follower: 类似选民，完全被动
    Candidate候选人: 类似Proposer律师，可以被选为一个新的领导人。

Raft阶段分为两个，首先是选举过程，然后在选举出来的领导人带领进行正常操作，比如日志复制等

