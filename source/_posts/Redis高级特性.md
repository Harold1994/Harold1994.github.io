---
title: Redis高级特性
date: 2018-09-27 09:41:28
tags: [NoSQL, Redis, 大数据]
---

#### 一、降低内存占用

降低Redis内存占用有助于减少创建快照和加载快照所需的时间，提升载入AOF文件时的效率，缩短从服务器进行同步所需的时间，并且能让Redis存储更多的数据而无需添加额外的硬件。

主要有三种技术：

* 短结构
* 分片
* 打包存储二进制位和字节

##### 1.短结构

在散列、列表、和有序集合的**长度较短或者体积较小**的时候，Redis可以选择使用**压缩列表(ziplist)**来存储这些结构，压缩列表是列表，散列和有序集合的一种非结构化的表示，它会以序列化的方式存储数据，这些数据每次被读取的时候都需要进行解码，每次被写入的时候要进行局部编码，可能要移动内存里的数据。

Redis存储长列表的方式见下图：

![](http://p5s7d12ls.bkt.clouddn.com/18-9-27/26093308.jpg)

可以看到用上面的方式存储数据的空间开销非常大，再来看压缩列表的结构：
压缩列表的每个节点由两个长度值和一个字符串组成，第一个数值记录前一个节点的长度，这个长度值被用于对压缩列表进行从后向前的遍历，第二个长度值记录当前节点长度，位于最后的是被存储得字符串，相对于存储长列表的方式，压缩列表避免存储额外的指针和元数据，降低了空间开销。

对于体积较小的集合，如果整数包含的所有成员都可以被解释为十进制整数，而这些整数又处于平台的有符号整数范围之内，并且集合成员的数量又足够小的话，那么Redis就会以有序整数组的方式存储集合，又被称为**整数集合intset**，他可以降低内存消耗，还可以提升所有标准集合操作的执行速度。

>缺陷：
>
>* 对一个压缩列表表示的对象的其中一部分进行读取或者更新，可能会需要对整个压缩列表进行解码，甚至需要对内存中的数据进行移动，因此读写一个较大的压缩列表可能会给性能带来负面影响。
>* 用整数集合在执行插入或者删除操作时需要对数据进行移动，同样会带来性能影响

基于上述缺陷，当一个结构突破了用户为压缩列表或整数集合设置的限制条件时，Redis就会自动将它转换为更典型的底层结构。

##### 2.分片

分片本质上就是使用某些简单的规则将数据划分为更小的部分，然后根据数据所属的部分决定将数据发送到那个位置。

