---
title: 操作系统基础
date: 2018-09-21 18:53:38
tags: [操作系统, 计算机基础]
---

### 一、计算机系统概述

#### 1.信息 = 位 + 上下文

源程序实际上是由0和1组成的位（又叫比特）序列，8个位被组织成一组，称为字节，每个字节表示程序中的某些文本字符。ASCII码其实就是用一个唯一的单字节大小的整数值来表示每个字符。程序以字节序列方式存储在文件中，每个字节都有一个整数值，对应于某些字符。

只由ASCII字符构成的文件称为文本文件，其他文件都叫二进制文件。

数字的机器表示方式与实际的整数和实数不同，他们是对真值的*有限近似*

<!-- more-->

#### 2.程序被其他程序翻译成不同的格式

每条程序语句必须被其他程序转化为一系列的低级机器语言指令，然后这些指令按照*可执行目标程序*的格式打包，并以二进制磁盘文件的形式存放起来。目标程序也叫可执行目标文件。

预处理器、编译器、汇编器、链接器一起构成了*编译系统*

- 预处理器读取程序头文件，将程序依赖的库文件直接插入到程序文本中，得到另一个程序
- 编译器将文本文件翻译成汇编程序
- 汇编器将汇编程序翻译成机器语言指令，打包成*可重定位目标程序*，保存在目标文件中，目标文件是二进制文件
- 链接器将需要的单独预编译好的目标文件合并到汇编器产生的目标文件中

#### 3.系统的硬件组成

![20180615102719354.png](https://i.loli.net/2019/03/22/5c948a697edda.png)

- 总线：贯穿整个系统的电子管道，携带信息字节并负责在各个部分组件间传递。通常传送固定长的的字节块，也就是字（word）。

- I/O设备：系统与外部设备连接的通道，每个I/O设备都通过一个控制器或适配器与I/O总线相连

- 主存：一个临时存储设备，在处理器执行程序时，存放程序和程序处理的数据。物理上，主存是一组动态随机存取存储器（DRAM）芯片组成的。逻辑上来讲，存储器是一个线性的字节数组，每个字节都有其唯一的地址（数组索引）。

- 处理器：解释（或执行）存储在主存中指令的引擎。处理器的核心是一个大小为一个字的存储设备（或寄存器），称为程序计数器（PC），在任何时刻，PC都指向主存中的某条机器语言指令。

  > 处理器从程序计数器指向的内存处读取指令，解释指令中的位，执行该指令指示的简单操作，然后更新PC，使其指向下一条指令，而这条指令并不一定和在内存中刚刚执行的指令相邻。

- 寄存器文件：一个小的存储设备，由一些单个字长的寄存器组成，每个寄存器都有唯一的名字

- ALU（算术逻辑单元）：更新计算新的数据和地址值。

  > CPU在指令要求下可能会执行如下操作：
  > **加载：**从主存复制一个字节或者一个字到寄存器，以覆盖寄存器原来的内容。
  >
  > **存储：**从寄存器复制一个字节或一个字到主存的某个位置，以覆盖这个位置上原来的内容。
  >
  > **操作：**把两个寄存器的内容复制到ALU，ALU对两个字做算术运算，并将结果存放到一个寄存器中，以覆盖寄存器原来的内容。
  >
  > **跳转:**从指令本身中抽取一个字，并将这个字复制到程序计数器（PC）中，以覆盖寄存器原来的内容。

利用直接存储器存取（DMA），数据可以不通过处理器而直接从磁盘到达主存。

#### 4.高速缓存

高速缓存存储器（cache memory）作为暂时的集结区域，存放处理器可能需要的信息。L1、L2高速缓存用静态随机访问存储器（SRAM）的硬件技术实现。

高速缓存的*局部性原理*：程序具有访问局部区域里的数据和代码的趋势，通过让高速缓存里存放可能经常访问的数据，大部分内存操作都能在快速的高速缓存中完成。

#### 5.存储设备形成层次结构

![屏幕快照 2019-03-22 下午3.14.23.png](https://i.loli.net/2019/03/22/5c948b596e027.png)

每个计算机系统中的存储设备都被组织成一个存储器层次结构，主要思想是上一层的存储器作为低一层存储器的高速缓存。

#### 6.操作系统管理硬件

可以把操作系统看成应用程序和硬件之间插入的一层软件，所有应用程序对硬件的操作都必须通过操作系统。

![1120165-20170911072834219-598375100.png](https://i.loli.net/2019/03/22/5c948b9d0dce1.png)

操作系统有两个基本功能：

- 防止硬件被时空的应用程序滥用
- 向应用程序提供简单一致的机制来控制复杂而又通常大不相同的硬件设备

操作系统通过几个基本抽象概念来实现这两个功能：

- 文件:文件是对I/O设备的抽象表示
- 虚拟内存：对主存和磁盘I/O设备的抽象表示
- 进程：对处理器、主存和I/O设备的抽象表示

##### 6.1 进程

进程是操作系统对一个正在运行的程序的一种抽象，在一个系统上可以同运行多个进程，而每个进程都好像在独占使用硬件。

并发运行：一个进程的指令和另一个进程的指令交错执行。并发运行是通过处理器在进程间切换来实现的，操作系统实现这种交错执行的机制称为**上下文切换**。

操作系统保持跟踪进程运行所需的所有状态信息，这种状态就是上下文

##### 6.2 线程

一个进程实际上可以有多个线程组成，每个线程运行在进程的上下文中，并共享代码和全局数据。

##### 6.3 虚拟内存

虚拟内存是一个抽象概念，为每个进程提供了一个假象，即每个进程都在独占的使用主存。每个进程看到的内存都是一致的，称为*虚拟地址空间*，如下图。每个进程看到的虚拟地址空间由大量准确定义的区构成，每个区都有专门的功能。

- ![1120165-20170911080525000-869430973.png](https://i.loli.net/2019/03/22/5c948bd25a761.png)
- 程序代码和数据：对所有进程来说，代码是从同意固定地址开始，紧接着是和C全局变量相对应的数据位置。代码和数据区是直接按照可执行目标文件的内容初始化的
- 堆：代码和数据区在进程一开始运行时就被指定了大小，对可以在运行时动态的扩展和收缩（像调用malloc,free时）
- 栈：位于用户虚拟地址空间顶部，编译器用它来实现函数调用，栈也可以在程序执行期间动态的扩展和收缩，每次调用一个函数时，栈就会增长；从一个函数返回时，栈就会收缩。
- 内核虚拟内存：不允许应用程序读写这个区域的内容或者直接调用内核代码定义的函数，他们必须调用内核来执行这些操作。

##### 6.4 文件

文件就是字节序列，每个I/O设备都可以看做文件，系统中所有输入输出都是通过使用Unix I/O的系统函数实现。

#### 7.重要主题

##### 7.1 Amdahl定律

Amdahl定律描述了改善任何过程的一般原则，主要思想是：当对系统的某个部分加速时，其对系统整体性能的影响取决于该部分的重要性和加速程度。

若执行某应用程序需要时间$T_{old}$，假设系统某部分所需执行时间与$T_{old}$比例为$\alpha$,而该部分提升比例为k,即该部分初始时间为$\alpha T_{old}$,现在需要时间为$(\alpha T_{old})/k$,因此总执行时间应为:

​	$$T_{new} = (1-\alpha)T_{old} + (\alpha T_{old})/k = T_{old}[(1-\alpha)+\alpha /k]​$$

 由此计算加速比$S=T_{old}/T_{new}$为：

​		$S=\frac 1{(1-\alpha)+\alpha /k}$

Amdahl的主要观点：要想显著提升整个系统，必须提升全系统中相当大部分的速度



