<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Hadpoop和Spark实现矩阵相乘 | lyyourc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/app.css">
  <!-- <link rel='stylesheet' href='http://fonts.useso.com/css?family=Source+Code+Pro'> -->
  
</head>

<body>
  <nav class="app-nav">
  
    
      <a href="/.">home</a>
    
  
    
      <a href="/archives">archive</a>
    
  
    
      <a href="/atom.xml">rss</a>
    
  
</nav>

  <main class="post">
  <article>
  <h1 class="article-title">
    <a href="/2018/07/04/Hadpoop和Spark实现矩阵相乘/">Hadpoop和Spark实现矩阵相乘</a>
  </h1>

  <section class="article-meta">
    <p class="article-date">July 04 2018</p>
  </section>

  <section class="article-entry">
    <p>矩阵的存储格式如下：</p>
<p>矩阵名 行号 列号 值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">M 0 0 1</span><br><span class="line">M 0 1 0</span><br><span class="line">M 0 2 2</span><br><span class="line">M 1 0 2									 </span><br><span class="line">M 1 1 3                          </span><br><span class="line">M 1 2 1							</span><br><span class="line">N 0 0 1</span><br><span class="line">N 0 1 0</span><br><span class="line">N 1 0 2</span><br><span class="line">N 1 1 3</span><br><span class="line">N 2 0 2</span><br><span class="line">N 2 1 0</span><br></pre></td></tr></table></figure>
<a id="more"></a> 
<h4 id="一、Hadoop实现"><a href="#一、Hadoop实现" class="headerlink" title="一、Hadoop实现"></a>一、Hadoop实现</h4><p><strong>1.方法一</strong></p>
<p><strong>Map1</strong>阶段：对于矩阵M，把列作为key,对于矩阵N,把行作为key</p>
<p><strong>Reduce1</strong>阶段：对于相同key的值，M矩阵和N矩阵的值做笛卡尔积，输出key：<code>(M的行) + （N的列值）+ （MN相乘的value</code>，输出的value：<code>“”</code></p>
<p><strong>Map2阶段</strong>：读取<strong>Reduce1</strong>的输出值</p>
<p><strong>Reduce2阶段</strong>：把所有相同key的value值相加，输出即可</p>
<p>第一次MapReduce:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        String str = value.toString();</span><br><span class="line">        String[] strs = str.split(<span class="string">" "</span>);</span><br><span class="line">        <span class="keyword">if</span> (strs[<span class="number">0</span>].equals(<span class="string">"M"</span>) &amp;&amp; strs.length == <span class="number">4</span>)</span><br><span class="line">            context.write(<span class="keyword">new</span> Text(strs[<span class="number">2</span>]), <span class="keyword">new</span> Text(strs[<span class="number">0</span>] + <span class="string">" "</span> + strs[<span class="number">1</span>] +<span class="string">" "</span> + strs[<span class="number">3</span>]));</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (strs[<span class="number">0</span>].equals(<span class="string">"N"</span>) &amp;&amp; strs.length == <span class="number">4</span>)</span><br><span class="line">            context.write(<span class="keyword">new</span> Text(strs[<span class="number">1</span>]), <span class="keyword">new</span> Text(strs[<span class="number">0</span>] + <span class="string">" "</span> + strs[<span class="number">2</span>] + <span class="string">" "</span> + strs[<span class="number">3</span>]));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WriteReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;Text&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        ArrayList&lt;String&gt; mTrix = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        ArrayList&lt;String&gt; nTrix = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">for</span> (Text value : values) &#123;</span><br><span class="line">            <span class="keyword">if</span> (value.toString().contains(<span class="string">"M"</span>))</span><br><span class="line">                mTrix.add(value.toString());</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                nTrix.add(value.toString());</span><br><span class="line">        &#125;</span><br><span class="line">        String [] mItems, nItems;</span><br><span class="line">        <span class="keyword">for</span> (String m : mTrix)&#123;</span><br><span class="line">            mItems = m.split(<span class="string">" "</span>);</span><br><span class="line">            <span class="keyword">for</span> (String n : nTrix) &#123;</span><br><span class="line">                nItems = n.split(<span class="string">" "</span>);</span><br><span class="line">                context.write(<span class="keyword">new</span> Text(key + <span class="string">"+"</span> + mItems[<span class="number">1</span>] + <span class="string">"+"</span> + nItems[<span class="number">1</span>] + <span class="string">"+"</span> + (Integer.parseInt(mItems[<span class="number">2</span>]) * Integer.parseInt(nItems[<span class="number">2</span>]))),<span class="keyword">new</span> Text(<span class="string">""</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MatrixMul</span> <span class="keyword">extends</span> <span class="title">Configured</span> <span class="keyword">implements</span> <span class="title">Tool</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(String[] strings)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration conf = getConf();</span><br><span class="line">        Job job = <span class="keyword">new</span> Job(conf);</span><br><span class="line">        job.setJarByClass(MatrixMul.class);</span><br><span class="line">        job.setJobName(<span class="string">"MatrixMul"</span>);</span><br><span class="line"></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(strings[<span class="number">0</span>]));</span><br><span class="line">       FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(strings[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">        job.setMapperClass(ReadMapper.class);</span><br><span class="line">        job.setReducerClass(WriteReducer.class);</span><br><span class="line"></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(Text.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> returnStatus = ToolRunner.run(<span class="keyword">new</span> MatrixMul(), args);</span><br><span class="line">        System.exit(returnStatus);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">0+1+1+0</span><br><span class="line">0+1+0+2</span><br><span class="line">0+0+1+0</span><br><span class="line">0+0+0+1</span><br><span class="line">1+1+1+9</span><br><span class="line">1+1+0+6</span><br><span class="line">1+0+1+0</span><br><span class="line">1+0+0+0</span><br><span class="line">2+1+1+0</span><br><span class="line">2+1+0+2</span><br><span class="line">2+0+1+0</span><br><span class="line">2+0+0+4</span><br></pre></td></tr></table></figure>
<p>第二次MapReduce:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MatrixMulStep2</span> <span class="keyword">extends</span> <span class="title">Configured</span> <span class="keyword">implements</span> <span class="title">Tool</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration conf = getConf();</span><br><span class="line">        Job job = <span class="keyword">new</span> Job(conf);</span><br><span class="line">        job.setJobName(<span class="string">"MatrixMulStep2"</span>);</span><br><span class="line">        job.setJarByClass(MatrixMulStep2.class);</span><br><span class="line"></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(args[<span class="number">0</span>]));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(args[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">        job.setOutputValueClass(Text.class);</span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line"></span><br><span class="line">        job.setMapperClass(ReadMapper1.class);</span><br><span class="line">        job.setReducerClass(WriteReducer1.class);</span><br><span class="line">        <span class="keyword">return</span> job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> returnStatus = ToolRunner.run(<span class="keyword">new</span> MatrixMulStep2(), args);</span><br><span class="line">        System.exit(returnStatus);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadMapper1</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        String[] str = value.toString().split(<span class="string">"\\+"</span>);</span><br><span class="line">        <span class="keyword">if</span> (str.length &gt;=<span class="number">4</span> )&#123;</span><br><span class="line">            context.write(<span class="keyword">new</span> Text(str[<span class="number">1</span>] + <span class="string">" "</span> + str[<span class="number">2</span>]), <span class="keyword">new</span> Text(str[<span class="number">3</span>]));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WriteReducer1</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;Text&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (Text t : values)</span><br><span class="line">            sum += Integer.parseInt(t.toString());</span><br><span class="line">        context.write(key, <span class="keyword">new</span> Text(sum + <span class="string">""</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">0 0	5</span><br><span class="line">0 1	0</span><br><span class="line">1 0	10</span><br><span class="line">1 1	9</span><br></pre></td></tr></table></figure>
<p><strong>2.方法二</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SingleStep</span> <span class="keyword">extends</span> <span class="title">Configured</span> <span class="keyword">implements</span> <span class="title">Tool</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> WIDTH = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LENGTH = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MATRIX_K = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MatrixMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">LongWritable</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">map</span><span class="params">(LongWritable key, Text value, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            String[] values = value.toString().split(<span class="string">" "</span>);</span><br><span class="line">            <span class="keyword">if</span> (values[<span class="number">0</span>].equals(<span class="string">"M"</span>)) &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; LENGTH; i++)</span><br><span class="line">                    context.write(<span class="keyword">new</span> Text(values[<span class="number">1</span>] + <span class="string">" "</span> + i), <span class="keyword">new</span> Text(values[<span class="number">0</span>] + <span class="string">" "</span> + values[<span class="number">2</span>] + <span class="string">" "</span> + values[<span class="number">3</span>]));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; WIDTH; i++)</span><br><span class="line">                    context.write(<span class="keyword">new</span> Text(i + <span class="string">" "</span> + values[<span class="number">2</span>]), <span class="keyword">new</span> Text(values[<span class="number">0</span>] + <span class="string">" "</span> + values[<span class="number">1</span>] + <span class="string">" "</span> + values[<span class="number">3</span>]));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MatrixReducer</span> <span class="keyword">extends</span> <span class="title">Reducer</span>&lt;<span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>, <span class="title">Text</span>&gt; </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">reduce</span><span class="params">(Text key, Iterable&lt;Text&gt; values, Context context)</span> <span class="keyword">throws</span> IOException, InterruptedException </span>&#123;</span><br><span class="line">            Integer[] m_matrix = <span class="keyword">new</span> Integer[MATRIX_K];</span><br><span class="line">            Integer[] n_matrix = <span class="keyword">new</span> Integer[MATRIX_K];</span><br><span class="line">            <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (Text value : values) &#123;</span><br><span class="line">                String[] tmp = value.toString().split(<span class="string">" "</span>);</span><br><span class="line">                <span class="keyword">if</span> (tmp[<span class="number">0</span>].equals(<span class="string">"M"</span>))</span><br><span class="line">                    m_matrix[Integer.parseInt(tmp[<span class="number">1</span>])] = Integer.parseInt(tmp[<span class="number">2</span>]);</span><br><span class="line">                <span class="keyword">else</span> n_matrix[Integer.parseInt(tmp[<span class="number">1</span>])] = Integer.parseInt(tmp[<span class="number">2</span>]);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">//对两个矩阵相乘相加</span></span><br><span class="line">            <span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; MATRIX_K; i++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (m_matrix[i] != <span class="keyword">null</span> &amp;&amp; n_matrix[i] != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    result += m_matrix[i] * n_matrix[i];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            context.write(key, <span class="keyword">new</span> Text(result + <span class="string">""</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">run</span><span class="params">(String[] strings)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Configuration conf = getConf();</span><br><span class="line">        Job job = <span class="keyword">new</span> Job(conf);</span><br><span class="line">        job.setJarByClass(MatrixMul.class);</span><br><span class="line">        job.setJobName(<span class="string">"SingleStep"</span>);</span><br><span class="line"></span><br><span class="line">        FileInputFormat.setInputPaths(job, <span class="keyword">new</span> Path(strings[<span class="number">0</span>]));</span><br><span class="line">        FileOutputFormat.setOutputPath(job, <span class="keyword">new</span> Path(strings[<span class="number">1</span>]));</span><br><span class="line"></span><br><span class="line">        job.setMapperClass(MatrixMapper.class);</span><br><span class="line">        job.setReducerClass(MatrixReducer.class);</span><br><span class="line"></span><br><span class="line">        job.setOutputKeyClass(Text.class);</span><br><span class="line">        job.setOutputValueClass(Text.class);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> job.waitForCompletion(<span class="keyword">true</span>) ? <span class="number">0</span> : <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> returnStatus = ToolRunner.run(<span class="keyword">new</span> SingleStep(), args);</span><br><span class="line">        System.exit(returnStatus);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="二、Spark实现"><a href="#二、Spark实现" class="headerlink" title="二、Spark实现"></a>二、Spark实现</h4><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">MatrixMulSpark</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">main</span></span>(args: <span class="type">Array</span>[<span class="type">String</span>]): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> conf = <span class="keyword">new</span> <span class="type">SparkConf</span>()</span><br><span class="line">      .setAppName(<span class="string">"MatrixMulSpark"</span>)</span><br><span class="line">      .setMaster(<span class="string">"local"</span>)</span><br><span class="line">    <span class="keyword">val</span> sc = <span class="keyword">new</span> <span class="type">SparkContext</span>(conf);</span><br><span class="line">    <span class="keyword">val</span> input = sc.textFile(<span class="string">"in/in.txt"</span>)</span><br><span class="line">    <span class="keyword">val</span> <span class="type">M</span> = input.filter(line =&gt; line.contains(<span class="string">"M"</span>))</span><br><span class="line">    <span class="keyword">val</span> <span class="type">N</span> = input.filter(line =&gt; line.contains(<span class="string">"N"</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> wordM = <span class="type">M</span>.map(line =&gt; &#123;</span><br><span class="line">      <span class="keyword">val</span> words = line.split(<span class="string">" "</span>)</span><br><span class="line">      (words(<span class="number">2</span>), words)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> wordN = <span class="type">N</span>.map( line =&gt; &#123;</span><br><span class="line">      <span class="keyword">val</span> word = line.split(<span class="string">" "</span>)</span><br><span class="line">      (word(<span class="number">1</span>), word)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> dword = wordM.join(wordN)</span><br><span class="line">    dword.collect.foreach(println)</span><br><span class="line">    <span class="keyword">val</span> map = dword.values.map( x =&gt; &#123;</span><br><span class="line">      (x._1(<span class="number">1</span>) + <span class="string">" "</span> + x._2(<span class="number">2</span>),x._1(<span class="number">3</span>).toDouble * x._2(<span class="number">3</span>).toDouble)</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">val</span> reduce = map.reduceByKey((x,y) =&gt; &#123;</span><br><span class="line">      x + y</span><br><span class="line">    &#125;)</span><br><span class="line">    reduce.foreach(x =&gt; println(x._1+<span class="string">" "</span> + x._2))</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
  </section>
</article>

  <div class="sharing grid">
  <section class="profile grid-item grid">
    <img class="avatar" src="http://7xrcp8.com1.z0.glb.clouddn.com/avatar.png" alt="avatar" />
    <div class="grid-item">
      <p class="title"> lyyourc </p>
      <p class="subtitle"> You Are The JavaScript In My HTML </p>
    <div>
  </section>

  <section class="share-btns">
    <!-- <p> share it if you like it~ </p> -->
    <a
  class="twitter-share-button"
  data-size="large"
  data-via="DrakeLeung"
  href="https://twitter.com/intent/tweet?text=矩阵的存储格式如下：</p>
<p>矩阵"
>
  Tweet
</a>

<script>
  window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  js.async = true;
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
</script>

  </section>
</div>


  
    
<section class="article-comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

<script>
  var disqus_shortname = 'drakeleung';
  
  var disqus_url = '//harold.me/2018/07/04/Hadpoop和Spark实现矩阵相乘/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  
</main>

</body>
</html>
