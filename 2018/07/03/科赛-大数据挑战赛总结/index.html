<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>科赛----大数据挑战赛总结 | lyyourc</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <link rel="shortcut icon" href="/favicon.ico">
  <link rel="stylesheet" href="/css/app.css">
  <!-- <link rel='stylesheet' href='http://fonts.useso.com/css?family=Source+Code+Pro'> -->
  
</head>

<body>
  <nav class="app-nav">
  
    
      <a href="/.">home</a>
    
  
    
      <a href="/archives">archive</a>
    
  
    
      <a href="/atom.xml">rss</a>
    
  
</nav>

  <main class="post">
  <article>
  <h1 class="article-title">
    <a href="/2018/07/03/科赛-大数据挑战赛总结/">科赛----大数据挑战赛总结</a>
  </h1>

  <section class="article-meta">
    <p class="article-date">July 03 2018</p>
  </section>

  <section class="article-entry">
    <p>这个比赛是我除了kaggle两个练手比赛之外第一次参加的比赛,历时一个月左右,有遗憾也有收获,不过收获总是大于遗憾的,作为第一个从头到尾参与的比赛,从数据集的划分,特征的生成到模型的选取与调优,一点一滴都是收获,最终成绩(初赛B榜)0.81670099,虽然不是特别高,但是思路总是值得记录的.</p>
<h4 id="一-赛题"><a href="#一-赛题" class="headerlink" title="一. 赛题"></a>一. 赛题</h4><p><strong>赛题描述</strong>:</p>
<pre><code>本次大赛基于脱敏和采样后的数据信息，预测未来一段时间活跃的用户。参赛队伍需要设计相应的算法进行数据分析和处理，比赛结果按照指定的评价指标使用在线评测数据进行评测和排名，得分最优者获胜。
</code></pre><a id="more"></a> 
<p><strong>数据说明</strong></p>
<p>​      大赛提供脱敏和采样后用户行为数据，日期信息进行统一编号，第一天编号为 01， 第二天为 02， 以此类推，所有文件中列使用 tab 分割。</p>
<p>1.注册日志（user_register_log.txt)</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>Int</td>
<td>用户唯一标识（脱敏后）</td>
<td>666</td>
</tr>
<tr>
<td>register_day</td>
<td>String</td>
<td>日期</td>
<td>01, 02 ..  30</td>
</tr>
<tr>
<td>register_type</td>
<td>Int</td>
<td>来源渠道（脱敏后）</td>
<td>0</td>
</tr>
<tr>
<td>device type</td>
<td>Int</td>
<td>设备类型（脱敏后）</td>
<td>0</td>
</tr>
</tbody>
</table>
<p>2.APP启动日志（app_launch_log.txt)</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>Int</td>
<td>用户唯一标识（脱敏后）</td>
<td>666</td>
</tr>
<tr>
<td>day</td>
<td>String</td>
<td>日期</td>
<td>01, 02 ..30</td>
</tr>
</tbody>
</table>
<p>3.拍摄日志（video_create_log.txt）</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>Int</td>
<td>用户唯一标识（脱敏后）</td>
<td>666</td>
</tr>
<tr>
<td>day</td>
<td>String</td>
<td>拍摄日期</td>
<td>01, 02 .. 30</td>
</tr>
</tbody>
</table>
<p>4.行为日志（user_activity_log.txt</p>
<table>
<thead>
<tr>
<th>列名</th>
<th>类型</th>
<th>说明</th>
<th>示例</th>
</tr>
</thead>
<tbody>
<tr>
<td>user_id</td>
<td>Int</td>
<td>用户唯一标识（脱敏后）</td>
<td>666</td>
</tr>
<tr>
<td>day</td>
<td>String</td>
<td>日期</td>
<td>01, 02</td>
</tr>
<tr>
<td>page</td>
<td>Int</td>
<td>行为发生的页面。每个数字分别对应“关注页”、”个人主页“、”发现页“、”同城页“或”其他页“中的一个</td>
<td>1</td>
</tr>
<tr>
<td>video_id</td>
<td>Int</td>
<td>video id（脱敏后）</td>
<td>333</td>
</tr>
<tr>
<td>author_id</td>
<td>Int</td>
<td>作者 id（脱敏后）</td>
<td>999</td>
</tr>
<tr>
<td>action_type</td>
<td>Int</td>
<td>用户行为类型。每个数字分别对应“播放“、”关注“、”点赞“、”转发“、”举报“和”减少此类作品“中的一个</td>
<td>1</td>
</tr>
</tbody>
</table>
<p><strong>评估标准</strong></p>
<p>设参赛选手提交的用户集合为 M，实际上未来 7 天内使用过快手的用户集合为 N ，且集合 N 是提供给选手的注册用户的子集。最终使用 F1 Score 作为参赛选手得分。F1 Score 越大，代表结果越优，排名越靠前。</p>
<h4 id="二-思路"><a href="#二-思路" class="headerlink" title="二.思路"></a>二.思路</h4><p>​    首先看这个题目是一个预测问题,根据前30天的表现预测用户之后七天是否活跃.在我看到baseline之前我是这样想的:<em>先提一些特征,然后利用最简单的 K-Means (K = 2) 做一下聚类 ,然后选出一类作为活跃的类,再从活跃的类中选出登录时间比较靠靠近最后一天的用户作为预测出来的活跃用户</em>.在我正在验证这个想法的半途中自己的Linux系统挂了,重装之后之前的工作就都没了,一度想弃赛…</p>
<p><strong>1.划分数据集</strong></p>
<p>​    好在加了比赛的群,而且科赛有讨论组,我发现大家和我想的完全不一样(果然新手和老鸟差距太大).这是一个分类问题,但是主办方并没有给出前三十天用户是否活跃的标签,因此需要我们自己去构造标签.因为数据是和时间完全相关的,因此使用滑窗法来构造标签.比如,使用第17-23的数据来标注第1-16天的数据,使用这种方法可以构造很多训练集.我采用了大多数人使用的构造方法:</p>
<p>train_set1: 用1-16天构造用户集, 1-16构造特征, 17-23构造标签</p>
<p>train_set2: 用1-23天构造用户集, 8-23构造特征, 24-30 构造标签</p>
<p>test_set: 1-30天构造用户集,15-30构造特征, 预测下月1-7</p>
<p>​    在划分数据集之前,先构造了两个全局特征,根据user_activity_log表观看视频的视频id和作者id(video_id和author_id)可以得到某个video_id和user_id的火热程度,同时根据video_create_log的user_id和user_activity_log的author_id可以构造用户发作为一个发布者的火热程度.</p>
<p>具体代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> DataFrame</span><br><span class="line"></span><br><span class="line">path =<span class="string">"data/"</span></span><br><span class="line">app = pd.read_table(path+<span class="string">'app_launch_log.txt'</span>,names=[<span class="string">'user_id'</span>,<span class="string">'day'</span>],encoding=<span class="string">'utf-8'</span>,sep=<span class="string">'\t'</span>,)</span><br><span class="line">user_act = pd.read_table(path+<span class="string">'user_activity_log.txt'</span>,names=[<span class="string">'user_id'</span>,<span class="string">'day'</span>,<span class="string">'page'</span>,<span class="string">'video_id'</span>,<span class="string">'author_id'</span>,<span class="string">'action_type'</span>],encoding=<span class="string">'utf-8'</span>,sep=<span class="string">'\t'</span>)</span><br><span class="line">user_reg = pd.read_table(path+<span class="string">'user_register_log.txt'</span>,names=[<span class="string">'user_id'</span>,<span class="string">'register_day'</span>,<span class="string">'register_type'</span>,<span class="string">'device_type'</span>],encoding=<span class="string">'utf-8'</span>,sep=<span class="string">'\t'</span>)</span><br><span class="line">video = pd.read_table(path+<span class="string">'video_create_log.txt'</span>,names=[<span class="string">'user_id'</span>,<span class="string">'day'</span>],encoding=<span class="string">'utf-8'</span>,sep=<span class="string">'\t'</span>)</span><br><span class="line"><span class="comment">#讲txt文件转为csv</span></span><br><span class="line">app.to_csv(<span class="string">'data/app_lauch_log.csv'</span>,index=<span class="keyword">False</span>)</span><br><span class="line">user_act.to_csv(<span class="string">'data/user_activity_log.csv'</span>,index=<span class="keyword">False</span>)</span><br><span class="line">user_reg.to_csv(<span class="string">'data/user_register_log.csv'</span>,index=<span class="keyword">False</span>)</span><br><span class="line">video.to_csv(<span class="string">'data/video_create_log.csv'</span>,index=<span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#构造特征:vid_hotness和video_norm_hot</span></span><br><span class="line">vid = pd.DataFrame(user_act.video_id)</span><br><span class="line">vid[<span class="string">'hot'</span>] = <span class="number">1</span></span><br><span class="line">v = vid.groupby(<span class="string">'video_id'</span>).count()</span><br><span class="line">v.reset_index(inplace=<span class="keyword">True</span>)</span><br><span class="line">v_norm = (v.hot - v.hot.min()) / (v.hot.max() - v.hot.min())</span><br><span class="line">v[<span class="string">'video_norm_hot'</span>]= v_norm</span><br><span class="line">v.rename(columns=&#123;<span class="string">'hot'</span>:<span class="string">'vid_hotness'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br><span class="line">user_act = pd.merge(user_act,v,on=<span class="string">'video_id'</span>,how=<span class="string">'left'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#构造特征:auth_hotness和author_norm_hot</span></span><br><span class="line">aut = pd.DataFrame(user_act.author_id)</span><br><span class="line">aut[<span class="string">'hot'</span>] = <span class="number">1</span></span><br><span class="line">a = aut.groupby(<span class="string">'author_id'</span>).count()</span><br><span class="line">a.reset_index(inplace=<span class="keyword">True</span>)</span><br><span class="line">a_norm = (a.hot - a.hot.min()) / (a.hot.max() - a.hot.min())</span><br><span class="line">a[<span class="string">'author_norm_hot'</span>] = a_norm</span><br><span class="line">a.rename(columns=&#123;<span class="string">'hot'</span>:<span class="string">'auth_hotness'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br><span class="line">user_act = pd.merge(user_act,a,on=<span class="string">'author_id'</span>,how=<span class="string">'left'</span>)</span><br><span class="line">user_act.to_csv(<span class="string">'data/user_activity_log.csv'</span>, index=<span class="keyword">False</span>)</span><br><span class="line">user_act.head()</span><br><span class="line"></span><br><span class="line"><span class="comment">#构造特征:hotness_as_creater和norm_hotness_as_creater</span></span><br><span class="line">a.rename(columns=&#123;<span class="string">'auth_hotness'</span>:<span class="string">'hotness_as_creater'</span>,<span class="string">'author_id'</span>:<span class="string">'user_id'</span>,<span class="string">'author_norm_hot'</span>:<span class="string">'norm_hotness_as_creater'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br><span class="line">video = pd.merge(video, a, on=<span class="string">'user_id'</span>,how=<span class="string">'left'</span>)</span><br><span class="line">video.head()</span><br><span class="line">video.to_csv(<span class="string">'data/video_create_log.csv'</span>,index=<span class="keyword">False</span>)</span><br><span class="line"></span><br><span class="line">A_train = <span class="string">'data/1_data_train_'</span></span><br><span class="line">B_train = <span class="string">'data/2_data_train_'</span></span><br><span class="line">C_train = <span class="string">'data/3_data_train_'</span></span><br><span class="line">A_test = <span class="string">'data/1_data_test_'</span></span><br><span class="line">B_test = <span class="string">'data/2_data_test_'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#划分数据</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cut_data_as_time</span><span class="params">(new_data_path, begin_day, end_day)</span>:</span></span><br><span class="line">    temp_register = user_reg[(user_reg[<span class="string">'register_day'</span>] &gt;= <span class="number">1</span>) &amp; (user_reg[<span class="string">'register_day'</span>] &lt;= end_day)]</span><br><span class="line">    temp_create = video[(video[<span class="string">'day'</span>] &gt;= begin_day) &amp; (video[<span class="string">'day'</span>] &lt;= end_day)]</span><br><span class="line">    temp_launch = app[(app[<span class="string">'day'</span>] &gt;= begin_day) &amp; (app[<span class="string">'day'</span>] &lt;= end_day)]</span><br><span class="line">    temp_activity = user_act[(user_act[<span class="string">'day'</span>] &gt;= begin_day) &amp; (user_act[<span class="string">'day'</span>] &lt;= end_day)]</span><br><span class="line">    </span><br><span class="line">    temp_register.to_csv(new_data_path + <span class="string">"register.csv"</span>, index = <span class="keyword">False</span>)</span><br><span class="line">    temp_activity.to_csv(new_data_path + <span class="string">"activity.csv"</span>, index = <span class="keyword">False</span>)</span><br><span class="line">    temp_launch.to_csv(new_data_path + <span class="string">"launch.csv"</span>, index = <span class="keyword">False</span>)</span><br><span class="line">    temp_create.to_csv(new_data_path + <span class="string">"create.csv"</span>, index = <span class="keyword">False</span>)</span><br><span class="line">    print(<span class="string">'根据起始和结束时间将数据集取出完成,存入:'</span>,new_data_path)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_dataset</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'开始划分数据集....'</span>)</span><br><span class="line">    begin_day = <span class="number">1</span></span><br><span class="line">    end_day = <span class="number">16</span></span><br><span class="line">    cut_data_as_time(A_train,begin_day, end_day)</span><br><span class="line">    begin_day = <span class="number">17</span></span><br><span class="line">    end_day = <span class="number">23</span></span><br><span class="line">    cut_data_as_time(A_test,begin_day, end_day)</span><br><span class="line">    print(<span class="string">'第一数据集划分完成'</span>)</span><br><span class="line">    begin_day = <span class="number">8</span></span><br><span class="line">    end_day = <span class="number">23</span></span><br><span class="line">    cut_data_as_time(B_train,begin_day, end_day)</span><br><span class="line">    begin_day = <span class="number">24</span></span><br><span class="line">    end_day = <span class="number">30</span></span><br><span class="line">    cut_data_as_time(B_test,begin_day, end_day)</span><br><span class="line">    print(<span class="string">'第二数据集划分完成'</span>)</span><br><span class="line">    begin_day = <span class="number">15</span></span><br><span class="line">    end_day = <span class="number">30</span></span><br><span class="line">    cut_data_as_time(C_train,begin_day, end_day)</span><br><span class="line">    print(<span class="string">'第三数据集划分完成'</span>)</span><br><span class="line">    print(<span class="string">'全部数据集划分完成.....'</span>)</span><br></pre></td></tr></table></figure>
<p><strong>2.构造数据集与特征</strong></p>
<p>​    在这一步我将要利用第一步划分好的窗口来给测试集打标签并构造特征.</p>
<p>​    打标签的功能比较好实现,只要前一个\指定数据集中的用户(如1-16中的用户)出现在打标签数据集中(如17-23),就标记该用户活跃状态为1,否则为0.</p>
<p>​    本次比赛我一共构造了160多个特征,他们来自数据的均值,方差,最大最小值,最近几天的活动次数,某一种活动的次数以及相邻几次活动的差值特性等.说一说遇到的坑,在最初几次提特征时提了30总的launch次数,activity次数等全局特征,在线下f1值猛增,线上提交却发现成绩陡降,仔细一想,自己利用滑窗法构造数据集进行训练,这种全局的数据一定会导致leak,因此万万要不得,算是吃一堑长一智吧.看到初赛后有人提了300多个特征,包括几天之内连续操作的次数,带windows权重的特征,带register_time权重的特征等等,只能说在下佩服,一定好好拜读代码.</p>
<p>​    一般来说，数据挖掘比赛等于特征构造比赛。特征构造的好坏决定了模型的上限，也基本能够保证模型的下限。但是特征也不是越多越好,就像我一样,虽然构造了那么多特征,但是最后发现全特征还不如最重要的30多个特征的效果(没错,最终只用了三十多个有效特征).</p>
<p>​    代码如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">from</span> pandas <span class="keyword">import</span> DataFrame</span><br><span class="line"><span class="keyword">from</span> scipy.stats <span class="keyword">import</span> stats</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"></span><br><span class="line">one_dataSet_train_path = <span class="string">"data/1_data_train_"</span></span><br><span class="line">one_dataSet_test_path = <span class="string">'data/1_data_test_'</span></span><br><span class="line">two_dataSet_train_path = <span class="string">'data/2_data_train_'</span></span><br><span class="line">two_dataSet_test_path = <span class="string">'data/2_data_test_'</span></span><br><span class="line">three_dataSet_train_path = <span class="string">'data/3_data_train_'</span></span><br><span class="line">train_path = <span class="string">'data/train_and_test/train.csv'</span></span><br><span class="line">test_path = <span class="string">'data/train_and_test/test.csv'</span></span><br><span class="line"></span><br><span class="line">register = <span class="string">'register.csv'</span></span><br><span class="line">create = <span class="string">'create.csv'</span></span><br><span class="line">launch = <span class="string">'launch.csv'</span></span><br><span class="line">activity = <span class="string">'activity.csv'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#构建训练集与测试集与特征</span></span><br><span class="line"><span class="comment">#获取所有id,查看对应id是否在测试集中出现过</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_train_label</span><span class="params">(train_path, test_path)</span>:</span></span><br><span class="line">    train_reg = pd.read_csv(train_path + register, usecols=[<span class="string">'user_id'</span>])</span><br><span class="line">    train_data_id = np.unique(train_reg)</span><br><span class="line">    </span><br><span class="line">    test_cre = pd.read_csv(test_path + create, usecols=[<span class="string">'user_id'</span>])</span><br><span class="line">    test_lau = pd.read_csv(test_path + launch, usecols=[<span class="string">'user_id'</span>])</span><br><span class="line">    test_act = pd.read_csv(test_path + activity, usecols=[<span class="string">'user_id'</span>])</span><br><span class="line">    test_data_id = np.unique(pd.concat([test_act, test_cre, test_lau]))</span><br><span class="line">    </span><br><span class="line">    train_label = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> train_data_id:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> test_data_id:</span><br><span class="line">            train_label.append(<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            train_label.append(<span class="number">0</span>)</span><br><span class="line">    train_data = pd.DataFrame()</span><br><span class="line">    train_data[<span class="string">'user_id'</span>] = train_data_id</span><br><span class="line">    train_data[<span class="string">'label'</span>] = train_label</span><br><span class="line">    <span class="keyword">return</span> train_data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_test</span><span class="params">(test_path)</span>:</span></span><br><span class="line">    test_reg = pd.read_csv(test_path + register, usecols=[<span class="string">'user_id'</span>])</span><br><span class="line">    test_cre = pd.read_csv(test_path + create, usecols=[<span class="string">'user_id'</span>])</span><br><span class="line">    test_lau = pd.read_csv(test_path + launch, usecols=[<span class="string">'user_id'</span>])</span><br><span class="line">    test_act = pd.read_csv(test_path + activity, usecols=[<span class="string">'user_id'</span>])</span><br><span class="line">    test_data_id = np.unique(test_reg)</span><br><span class="line">    test_data = pd.DataFrame()</span><br><span class="line">    test_data[<span class="string">'user_id'</span>] = test_data_id</span><br><span class="line">    <span class="keyword">return</span> test_data</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_create_feature</span><span class="params">(row)</span>:</span></span><br><span class="line">    feature = pd.Series()</span><br><span class="line">    feature[<span class="string">'user_id'</span>] = list(row[<span class="string">'user_id'</span>])[<span class="number">0</span>]</span><br><span class="line">    feature[<span class="string">'create_count_recent_days'</span>] = int (pd.DataFrame(row[<span class="string">'user_id'</span>]).count())</span><br><span class="line">    diff = list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - list(row[<span class="string">'register_day'</span>])[<span class="number">0</span>] + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> diff &gt;= <span class="number">15</span>:</span><br><span class="line">        diff = <span class="number">15</span></span><br><span class="line">    feature[<span class="string">'create_count_in_last_3_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>)].count())</span><br><span class="line">    feature[<span class="string">'create_count_in_last_5_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>)].count())</span><br><span class="line">    feature[<span class="string">'create_count_in_last_7_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>)].count())</span><br><span class="line">    feature[<span class="string">'create_count_in_last_9_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">8</span>)].count())</span><br><span class="line">    </span><br><span class="line">    feature[<span class="string">'create_day_mean'</span>] = float (feature[<span class="string">'create_count_recent_days'</span>]/(diff+<span class="number">1</span>))</span><br><span class="line">    feature[<span class="string">'create_day_max'</span>] = int(pd.DataFrame(row[<span class="string">'day'</span>]).max())</span><br><span class="line">    feature[<span class="string">'create_day_min'</span>] = int (pd.DataFrame(row[<span class="string">'day'</span>]).min())</span><br><span class="line">    feature[<span class="string">'create_day_max_sub_min'</span>] = feature[<span class="string">'create_day_max'</span>] - feature[<span class="string">'create_day_min'</span>]</span><br><span class="line">    feature[<span class="string">'create_day_std'</span>] = float (pd.DataFrame(row[<span class="string">'day'</span>]).std())</span><br><span class="line">    feature[<span class="string">'create_day_var'</span>] = float (pd.DataFrame(row[<span class="string">'day'</span>]).var())</span><br><span class="line">    feature[<span class="string">'create_day_skew'</span>] = float (pd.DataFrame(row[<span class="string">'day'</span>]).skew())</span><br><span class="line">    feature[<span class="string">'create_day_kur'</span>] = float (pd.DataFrame(row[<span class="string">'day'</span>]).kurt())</span><br><span class="line">    feature[<span class="string">'last_day_cut_max_day'</span>] = list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - feature[<span class="string">'create_day_max'</span>]</span><br><span class="line">    feature[<span class="string">'first_day_cut_register_day'</span>] = feature[<span class="string">'create_day_min'</span>] - list(row[<span class="string">'register_day'</span>])[<span class="number">0</span>]</span><br><span class="line">    feature[<span class="string">'max_create_times_one_day'</span>] = int (row.groupby(<span class="string">'day'</span>).count()[<span class="string">'user_id'</span>].max())</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> row.day.count() &gt; <span class="number">1</span>:</span><br><span class="line">        a = np.array(row.day)[:<span class="number">-1</span>]</span><br><span class="line">        b = np.array(row.day)[<span class="number">1</span>:]</span><br><span class="line">        tmp = pd.DataFrame(b-a)</span><br><span class="line">        feature[<span class="string">'create_day_diff_mean'</span>] = float (tmp.mean())</span><br><span class="line">        feature[<span class="string">'create_day_diff_max'</span>] = int (tmp.max())</span><br><span class="line">        feature[<span class="string">'create_day_diff_min'</span>] = int (tmp.min())</span><br><span class="line">        feature[<span class="string">'create_day_diff_std'</span>] = float (tmp.std())</span><br><span class="line">        feature[<span class="string">'create_day_diff_var'</span>] = float (tmp.var())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        feature[<span class="string">'create_day_diff_mean'</span>] = np.nan</span><br><span class="line">        feature[<span class="string">'create_day_diff_max'</span>] = np.nan</span><br><span class="line">        feature[<span class="string">'create_day_diff_min'</span>] = np.nan</span><br><span class="line">        feature[<span class="string">'create_day_diff_std'</span>] = np.nan</span><br><span class="line">        feature[<span class="string">'create_day_diff_var'</span>] = np.nan</span><br><span class="line">    <span class="keyword">return</span> feature      </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_launch_feature</span><span class="params">(row)</span>:</span></span><br><span class="line">    feature = pd.Series()</span><br><span class="line">    feature[<span class="string">'user_id'</span>] = list(row[<span class="string">'user_id'</span>])[<span class="number">0</span>]</span><br><span class="line">    feature[<span class="string">'launch_count_recent_days'</span>] = int (pd.DataFrame(row[<span class="string">'user_id'</span>]).count())</span><br><span class="line">    diff = list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - list(row[<span class="string">'register_day'</span>])[<span class="number">0</span>] + <span class="number">1</span></span><br><span class="line">    feature[<span class="string">'reg_now_diff'</span>] = diff</span><br><span class="line">    <span class="keyword">if</span> diff &gt;= <span class="number">15</span>:</span><br><span class="line">        diff = <span class="number">15</span></span><br><span class="line">    feature[<span class="string">'launch_count_in_last_3_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>)].count())</span><br><span class="line">    feature[<span class="string">'launch_count_in_last_5_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>)].count())</span><br><span class="line">    feature[<span class="string">'launch_count_in_last_7_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>)].count())</span><br><span class="line">    feature[<span class="string">'launch_count_in_last_9_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">8</span>)].count())    </span><br><span class="line">    feature[<span class="string">'launch_day_mean'</span>] = float (feature[<span class="string">'launch_count_recent_days'</span>]/(diff+<span class="number">1</span>))</span><br><span class="line">    feature[<span class="string">'launch_day_max'</span>] = int (pd.DataFrame(row[<span class="string">'day'</span>]).max())</span><br><span class="line">    feature[<span class="string">'launch_day_min'</span>] = int (pd.DataFrame(row[<span class="string">'day'</span>]).min())</span><br><span class="line">    feature[<span class="string">'launch_day_max_sub_min'</span>] = feature[<span class="string">'launch_day_max'</span>] - feature[<span class="string">'launch_day_min'</span>]</span><br><span class="line">    feature[<span class="string">'launch_day_std'</span>] = float (pd.DataFrame(row[<span class="string">'day'</span>]).std())</span><br><span class="line">    feature[<span class="string">'launch_day_var'</span>] = float (pd.DataFrame(row[<span class="string">'day'</span>]).var())</span><br><span class="line">    feature[<span class="string">'launch_day_kur'</span>] = float (pd.DataFrame(row[<span class="string">'day'</span>]).kurt())</span><br><span class="line">    feature[<span class="string">'launch_day_skew'</span>] = float (pd.DataFrame(row[<span class="string">'day'</span>]).skew())</span><br><span class="line">    feature[<span class="string">'last_launch_day_cut_max_day'</span>] = list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - feature[<span class="string">'launch_day_max'</span>]</span><br><span class="line">    feature[<span class="string">'first_launch_day_cut_register_day'</span>] = feature[<span class="string">'launch_day_min'</span>] - list(row[<span class="string">'register_day'</span>])[<span class="number">0</span>]</span><br><span class="line">    feature[<span class="string">'launch_mean_cut_max_day'</span>] = feature[<span class="string">'launch_day_mean'</span>] - list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>]</span><br><span class="line">    feature[<span class="string">'max_launch_times_one_day'</span>] = int (row.groupby(<span class="string">'day'</span>).count()[<span class="string">'user_id'</span>].max())</span><br><span class="line">    <span class="keyword">if</span> row.day.count() &gt; <span class="number">1</span>:</span><br><span class="line">        a = np.array(row.day)[:<span class="number">-1</span>]</span><br><span class="line">        b = np.array(row.day)[<span class="number">1</span>:]</span><br><span class="line">        tmp = pd.DataFrame(b-a)</span><br><span class="line">        feature[<span class="string">'launch_day_diff_mean'</span>] = float (tmp.mean())</span><br><span class="line">        feature[<span class="string">'launch_day_diff_max'</span>]  = int (tmp.max())</span><br><span class="line">        feature[<span class="string">'launch_day_diff_min'</span>]  = int (tmp.min())</span><br><span class="line">        feature[<span class="string">'launch_day_diff_std'</span>] = float (tmp.std())</span><br><span class="line">        feature[<span class="string">'launch_day_diff_var'</span>] = float (tmp.var())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        feature[<span class="string">'launch_day_diff_mean'</span>] = np.nan</span><br><span class="line">        feature[<span class="string">'launch_day_diff_max'</span>]  = np.nan</span><br><span class="line">        feature[<span class="string">'launch_day_diff_min'</span>]  = np.nan</span><br><span class="line">        feature[<span class="string">'launch_day_diff_std'</span>] = np.nan</span><br><span class="line">        feature[<span class="string">'launch_day_diff_var'</span>] = np.nan</span><br><span class="line">    <span class="keyword">return</span> feature   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_activity_feature</span><span class="params">(row)</span>:</span></span><br><span class="line">    feature = pd.Series()</span><br><span class="line">    feature[<span class="string">'user_id'</span>] = list(row[<span class="string">'user_id'</span>])[<span class="number">0</span>]</span><br><span class="line">    diff = list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - list(row[<span class="string">'register_day'</span>])[<span class="number">0</span>] + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> diff &gt;= <span class="number">15</span>:</span><br><span class="line">        diff = <span class="number">15</span></span><br><span class="line">    feature[<span class="string">'act_count_in_last_3_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>)].count())</span><br><span class="line">    feature[<span class="string">'act_count_in_last_5_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>)].count())</span><br><span class="line">    feature[<span class="string">'act_count_in_last_7_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>)].count())</span><br><span class="line">    feature[<span class="string">'act_count_in_last_9_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">8</span>)].count())</span><br><span class="line">    feature[<span class="string">'activity_count'</span>] = int (pd.DataFrame(row[<span class="string">'user_id'</span>]).count())</span><br><span class="line">    feature[<span class="string">'activity_day_mean'</span>] = float (feature[<span class="string">'activity_count'</span>]/(diff+<span class="number">1</span>))</span><br><span class="line">    feature[<span class="string">'activity_day_max'</span>] = int (row[<span class="string">'day'</span>].max())</span><br><span class="line">    feature[<span class="string">'activity_day_min'</span>] = int (row[<span class="string">'day'</span>].min())</span><br><span class="line">    feature[<span class="string">'activity_day_std'</span>] = float (row[<span class="string">'day'</span>].std())</span><br><span class="line">    feature[<span class="string">'activity_day_var'</span>] = float (row[<span class="string">'day'</span>].var())</span><br><span class="line">    feature[<span class="string">'activity_day_ske'</span>] = float (row[<span class="string">'day'</span>].skew())</span><br><span class="line">    feature[<span class="string">'activity_day_kur'</span>] = float (row[<span class="string">'day'</span>].skew())</span><br><span class="line">    feature[<span class="string">'activity_day_max_cut_min'</span>] =  feature[<span class="string">'activity_day_max'</span>] - feature[<span class="string">'activity_day_min'</span>]</span><br><span class="line">    feature[<span class="string">'activity_day_cut_max_day'</span>] = list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - feature[<span class="string">'activity_day_max'</span>]</span><br><span class="line">    feature[<span class="string">'activity_day_cut_register_day'</span>] = feature[<span class="string">'activity_day_min'</span>] - list(row[<span class="string">'register_day'</span>])[<span class="number">0</span>]</span><br><span class="line">    feature[<span class="string">'act_sub_register'</span>] = feature[<span class="string">'activity_day_min'</span>] - list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>]</span><br><span class="line">    feature[<span class="string">'act_count_in_last_3_day'</span>] = int (row.day[row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>)].count())</span><br><span class="line">    feature[<span class="string">'0_page_count'</span>] = int (row.page[row.page==<span class="number">0</span>].count())</span><br><span class="line">    feature[<span class="string">'1_page_count'</span>] = int (row.page[row.page==<span class="number">1</span>].count())</span><br><span class="line">    feature[<span class="string">'2_page_count'</span>] = int (row.page[row.page==<span class="number">2</span>].count())</span><br><span class="line">    feature[<span class="string">'3_page_count'</span>] = int (row.page[row.page==<span class="number">3</span>].count())</span><br><span class="line">    feature[<span class="string">'4_page_count'</span>] = int (row.page[row.page==<span class="number">4</span>].count())</span><br><span class="line">    </span><br><span class="line">    feature[<span class="string">'0_page_count_in_3_days'</span>] = int (row.page[(row.page==<span class="number">0</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>))].count())</span><br><span class="line">    feature[<span class="string">'1_page_count_in_3_days'</span>] = int (row.page[(row.page==<span class="number">1</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>))].count())</span><br><span class="line">    feature[<span class="string">'2_page_count_in_3_days'</span>] = int (row.page[(row.page==<span class="number">2</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>))].count())</span><br><span class="line">    feature[<span class="string">'3_page_count_in_3_days'</span>] = int (row.page[(row.page==<span class="number">3</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>))].count())</span><br><span class="line">    feature[<span class="string">'4_page_count_in_3_days'</span>] = int (row.page[(row.page==<span class="number">4</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>))].count())</span><br><span class="line">    </span><br><span class="line">    feature[<span class="string">'0_page_count_in_5_days'</span>] = int (row.page[(row.page==<span class="number">0</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>))].count())</span><br><span class="line">    feature[<span class="string">'1_page_count_in_5_days'</span>] = int (row.page[(row.page==<span class="number">1</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>))].count())</span><br><span class="line">    feature[<span class="string">'2_page_count_in_5_days'</span>] = int (row.page[(row.page==<span class="number">2</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>))].count())</span><br><span class="line">    feature[<span class="string">'3_page_count_in_5_days'</span>] = int (row.page[(row.page==<span class="number">3</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>))].count())</span><br><span class="line">    feature[<span class="string">'4_page_count_in_5_days'</span>] = int (row.page[(row.page==<span class="number">4</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>))].count())</span><br><span class="line">    </span><br><span class="line">    feature[<span class="string">'0_page_count_in_7_days'</span>] = int (row.page[(row.page==<span class="number">0</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>))].count())</span><br><span class="line">    feature[<span class="string">'1_page_count_in_7_days'</span>] = int (row.page[(row.page==<span class="number">1</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>))].count())</span><br><span class="line">    feature[<span class="string">'2_page_count_in_7_days'</span>] = int (row.page[(row.page==<span class="number">2</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>))].count())</span><br><span class="line">    feature[<span class="string">'3_page_count_in_7_days'</span>] = int (row.page[(row.page==<span class="number">3</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>))].count())</span><br><span class="line">    feature[<span class="string">'4_page_count_in_7_days'</span>] = int (row.page[(row.page==<span class="number">4</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>))].count())</span><br><span class="line">    </span><br><span class="line">    feature[<span class="string">'0_page_count_div_sum'</span>] = float((feature[<span class="string">'0_page_count'</span>] + <span class="number">1</span>)/(feature[<span class="string">'activity_count'</span>] + <span class="number">1</span>))</span><br><span class="line">    feature[<span class="string">'1_page_count_div_sum'</span>] = float((feature[<span class="string">'1_page_count'</span>] + <span class="number">1</span>)/(feature[<span class="string">'activity_count'</span>] + <span class="number">1</span>))</span><br><span class="line">    feature[<span class="string">'2_page_count_div_sum'</span>] = float((feature[<span class="string">'2_page_count'</span>] + <span class="number">1</span>)/(feature[<span class="string">'activity_count'</span>] + <span class="number">1</span>))</span><br><span class="line">    feature[<span class="string">'3_page_count_div_sum'</span>] = float((feature[<span class="string">'3_page_count'</span>] + <span class="number">1</span>)/(feature[<span class="string">'activity_count'</span>] + <span class="number">1</span>))</span><br><span class="line">    feature[<span class="string">'4_page_count_div_sum'</span>] = float((feature[<span class="string">'4_page_count'</span>] + <span class="number">1</span>)/(feature[<span class="string">'activity_count'</span>] + <span class="number">1</span>))</span><br><span class="line">    </span><br><span class="line">    feature[<span class="string">'0_action_count'</span>] = int (row.action_type[row.action_type==<span class="number">0</span>].count())</span><br><span class="line">    feature[<span class="string">'1_action_count'</span>] = int (row.action_type[row.action_type==<span class="number">1</span>].count())</span><br><span class="line">    feature[<span class="string">'2_action_count'</span>] = int (row.action_type[row.action_type==<span class="number">2</span>].count())</span><br><span class="line">    feature[<span class="string">'3_action_count'</span>] = int (row.action_type[row.action_type==<span class="number">3</span>].count())</span><br><span class="line">    feature[<span class="string">'4_action_count'</span>] = int (row.action_type[row.action_type==<span class="number">4</span>].count())</span><br><span class="line">    feature[<span class="string">'5_action_count'</span>] = int (row.action_type[row.action_type==<span class="number">5</span>].count())</span><br><span class="line">    </span><br><span class="line">    feature[<span class="string">'0_action_count_in_3_days'</span>] = int (row.action_type[(row.action_type==<span class="number">0</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>))].count())</span><br><span class="line">    feature[<span class="string">'1_action_count_in_3_days'</span>] = int (row.action_type[(row.action_type==<span class="number">1</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>))].count())</span><br><span class="line">    feature[<span class="string">'2_action_count_in_3_days'</span>] = int (row.action_type[(row.action_type==<span class="number">2</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>))].count())</span><br><span class="line">    feature[<span class="string">'3_action_count_in_3_days'</span>] = int (row.action_type[(row.action_type==<span class="number">3</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>))].count())</span><br><span class="line">    feature[<span class="string">'4_action_count_in_3_days'</span>] = int (row.action_type[(row.action_type==<span class="number">4</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>))].count())</span><br><span class="line">    feature[<span class="string">'5_action_count_in_3_days'</span>] = int (row.action_type[(row.action_type==<span class="number">5</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">2</span>))].count())</span><br><span class="line">    </span><br><span class="line">    feature[<span class="string">'0_action_count_in_5_days'</span>] = int (row.action_type[(row.action_type==<span class="number">0</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>))].count())</span><br><span class="line">    feature[<span class="string">'1_action_count_in_5_days'</span>] = int (row.action_type[(row.action_type==<span class="number">1</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>))].count())</span><br><span class="line">    feature[<span class="string">'2_action_count_in_5_days'</span>] = int (row.action_type[(row.action_type==<span class="number">2</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>))].count())</span><br><span class="line">    feature[<span class="string">'3_action_count_in_5_days'</span>] = int (row.action_type[(row.action_type==<span class="number">3</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>))].count())</span><br><span class="line">    feature[<span class="string">'4_action_count_in_5_days'</span>] = int (row.action_type[(row.action_type==<span class="number">4</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>))].count())</span><br><span class="line">    feature[<span class="string">'5_action_count_in_5_days'</span>] = int (row.action_type[(row.action_type==<span class="number">5</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">4</span>))].count())</span><br><span class="line">    </span><br><span class="line">    feature[<span class="string">'0_action_count_in_7_days'</span>] = int (row.action_type[(row.action_type==<span class="number">0</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>))].count())</span><br><span class="line">    feature[<span class="string">'1_action_count_in_7_days'</span>] = int (row.action_type[(row.action_type==<span class="number">1</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>))].count())</span><br><span class="line">    feature[<span class="string">'2_action_count_in_7_days'</span>] = int (row.action_type[(row.action_type==<span class="number">2</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>))].count())</span><br><span class="line">    feature[<span class="string">'3_action_count_in_7_days'</span>] = int (row.action_type[(row.action_type==<span class="number">3</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>))].count())</span><br><span class="line">    feature[<span class="string">'4_action_count_in_7_days'</span>] = int (row.action_type[(row.action_type==<span class="number">4</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>))].count())</span><br><span class="line">    feature[<span class="string">'5_action_count_in_7_days'</span>] = int (row.action_type[(row.action_type==<span class="number">5</span>)&amp;(row.day &gt;= (list(row[<span class="string">'max_day'</span>])[<span class="number">0</span>] - <span class="number">6</span>))].count())</span><br><span class="line">    feature[<span class="string">'0_action_count_div_sum'</span>] = float(feature[<span class="string">'0_action_count'</span>]/feature[<span class="string">'activity_count'</span>])</span><br><span class="line">    feature[<span class="string">'1_action_count_div_sum'</span>] = (feature[<span class="string">'1_action_count'</span>] + <span class="number">1</span>)/(feature[<span class="string">'activity_count'</span>] + <span class="number">1</span>)</span><br><span class="line">    feature[<span class="string">'2_action_count_div_sum'</span>] = (feature[<span class="string">'2_action_count'</span>] + <span class="number">1</span>)/(feature[<span class="string">'activity_count'</span>] + <span class="number">1</span>)</span><br><span class="line">    feature[<span class="string">'3_action_count_div_sum'</span>] = (feature[<span class="string">'3_action_count'</span>] + <span class="number">1</span>)/(feature[<span class="string">'activity_count'</span>] + <span class="number">1</span>)</span><br><span class="line">    feature[<span class="string">'4_action_count_div_sum'</span>] = (feature[<span class="string">'4_action_count'</span>] + <span class="number">1</span>)/(feature[<span class="string">'activity_count'</span>] + <span class="number">1</span>)</span><br><span class="line">    feature[<span class="string">'5_action_count_div_sum'</span>] = (feature[<span class="string">'5_action_count'</span>] + <span class="number">1</span>)/(feature[<span class="string">'activity_count'</span>] + <span class="number">1</span>)</span><br><span class="line">    feature[<span class="string">'max_act_times_per_day'</span>] = int (row.groupby(<span class="string">'day'</span>).count()[<span class="string">'user_id'</span>].max())</span><br><span class="line">    feature[<span class="string">'max_hot_vid'</span>] = float(row.vid_hotness.max())</span><br><span class="line">    feature[<span class="string">'max_hot_auth'</span>] = float(row.auth_hotness.max())</span><br><span class="line">    feature[<span class="string">'mean_hot_vid'</span>] = float(row.vid_hotness.mean())</span><br><span class="line">    feature[<span class="string">'mean_hot_auth'</span>] = float(row.auth_hotness.mean())</span><br><span class="line">    feature[<span class="string">'std_hot_vid'</span>] = float(row.vid_hotness.std())</span><br><span class="line">    feature[<span class="string">'kur_hot_vid'</span>] = float(row.vid_hotness.kurt())</span><br><span class="line">    feature[<span class="string">'min_hot_vid'</span>] = float(row.vid_hotness.min())</span><br><span class="line">    feature[<span class="string">'min_hot_auth'</span>] = float(row.auth_hotness.min())</span><br><span class="line">    feature[<span class="string">'sum_hot_vid'</span>] = float(row.vid_hotness.sum())</span><br><span class="line">    feature[<span class="string">'sum_hot_auth'</span>] = float(row.auth_hotness.sum())</span><br><span class="line">    feature[<span class="string">'std_hot_auth'</span>] = float(row.auth_hotness.std())</span><br><span class="line">    feature[<span class="string">'kur_hot_auth'</span>] = float(row.auth_hotness.kurt())</span><br><span class="line">    feature[<span class="string">'norm_max_hot_vid'</span>] = float(row.video_norm_hot.max())</span><br><span class="line">    feature[<span class="string">'norm_max_hot_auth'</span>] = float(row.author_norm_hot.max())</span><br><span class="line">    feature[<span class="string">'norm_mean_hot_vid'</span>] = float(row.video_norm_hot.mean())</span><br><span class="line">    feature[<span class="string">'norm_mean_hot_auth'</span>] = float(row.author_norm_hot.mean())</span><br><span class="line">    feature[<span class="string">'norm_std_hot_vid'</span>] = float(row.video_norm_hot.std())</span><br><span class="line">    feature[<span class="string">'norm_kur_hot_vid'</span>] = float(row.video_norm_hot.kurt())</span><br><span class="line">    feature[<span class="string">'norm_min_hot_vid'</span>] = float(row.video_norm_hot.min())</span><br><span class="line">    feature[<span class="string">'norm_min_hot_auth'</span>] = float(row.author_norm_hot.min())</span><br><span class="line">    feature[<span class="string">'norm_sum_hot_vid'</span>] = float(row.video_norm_hot.sum())</span><br><span class="line">    feature[<span class="string">'norm_sum_hot_auth'</span>] = float(row.author_norm_hot.sum())</span><br><span class="line">    feature[<span class="string">'norm_std_hot_auth'</span>] = float(row.author_norm_hot.std())</span><br><span class="line">    feature[<span class="string">'norm_kur_hot_auth'</span>] = float(row.author_norm_hot.kurt())</span><br><span class="line">    <span class="keyword">if</span> row.day.count() &gt; <span class="number">1</span>:</span><br><span class="line">        a = np.array(row.day)[:<span class="number">-1</span>]</span><br><span class="line">        b = np.array(row.day)[<span class="number">1</span>:]</span><br><span class="line">        tmp = pd.DataFrame(b-a)</span><br><span class="line">        feature[<span class="string">'activity_day_diff_mean'</span>] = float (tmp.mean())</span><br><span class="line">        feature[<span class="string">'activity_day_diff_max'</span>]  = int (tmp.max())</span><br><span class="line">        feature[<span class="string">'activity_day_diff_min'</span>]  = int (tmp.min())</span><br><span class="line">        feature[<span class="string">'activity_day_diff_std'</span>] = float (tmp.std())</span><br><span class="line">        feature[<span class="string">'activity_day_diff_var'</span>] = float (tmp.var())</span><br><span class="line">        feature[<span class="string">'activity_day_diff_ske'</span>] = float (tmp.skew())</span><br><span class="line">        feature[<span class="string">'activity_day_diff_kur'</span>] = float (tmp.kurt())</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        feature[<span class="string">'activity_day_diff_mean'</span>] = np.nan</span><br><span class="line">        feature[<span class="string">'activity_day_diff_max'</span>]  = np.nan</span><br><span class="line">        feature[<span class="string">'activity_day_diff_min'</span>]  = np.nan</span><br><span class="line">        feature[<span class="string">'activity_day_diff_std'</span>] = np.nan</span><br><span class="line">        feature[<span class="string">'activity_day_diff_var'</span>] = np.nan</span><br><span class="line">        feature[<span class="string">'activity_day_diff_ske'</span>] = np.nan</span><br><span class="line">        feature[<span class="string">'activity_day_diff_kur'</span>] = np.nan</span><br><span class="line">    <span class="keyword">return</span> feature  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">deal_feature</span><span class="params">(path, user_id)</span>:</span></span><br><span class="line">    reg = pd.read_csv(path + register)</span><br><span class="line">    cre = pd.read_csv(path + create)</span><br><span class="line">    lau = pd.read_csv(path + launch)</span><br><span class="line">    act = pd.read_csv(path + activity)</span><br><span class="line">    feature = pd.DataFrame()</span><br><span class="line">    feature[<span class="string">'user_id'</span>] = user_id</span><br><span class="line">    </span><br><span class="line">    reg_day = pd.DataFrame()</span><br><span class="line">    reg_day[<span class="string">'user_id'</span>] = reg.user_id</span><br><span class="line">    reg_day[<span class="string">'register_day'</span>] = reg.register_day</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    cre = pd.merge(cre,reg_day,on=<span class="string">'user_id'</span>, how=<span class="string">'left'</span>)</span><br><span class="line">    cre[<span class="string">'max_day'</span>] = np.max(reg[<span class="string">'register_day'</span>])</span><br><span class="line">    cre_feature = cre.groupby(<span class="string">'user_id'</span>, sort = <span class="keyword">True</span>).apply(get_create_feature)</span><br><span class="line">    feature = pd.merge(feature, pd.DataFrame(cre_feature), on=<span class="string">'user_id'</span>, how=<span class="string">'left'</span>)</span><br><span class="line">    print(<span class="string">'create表特征提取完毕'</span>)</span><br><span class="line">    </span><br><span class="line">    feature = pd.merge(feature, reg, on=<span class="string">'user_id'</span>, how=<span class="string">'left'</span>)</span><br><span class="line">    feature[<span class="string">'register_day_cut_max_day'</span>] = (np.max(reg[<span class="string">'register_day'</span>]) - feature.register_day)</span><br><span class="line">    print(<span class="string">'register表特征提取完毕'</span>)</span><br><span class="line">    </span><br><span class="line">    lau = pd.merge(lau,reg_day,on=<span class="string">'user_id'</span>, how=<span class="string">'left'</span>)</span><br><span class="line">    lau[<span class="string">'max_day'</span>] = np.max(reg[<span class="string">'register_day'</span>])</span><br><span class="line">    lau_feature = lau.groupby(<span class="string">'user_id'</span>, sort = <span class="keyword">True</span>).apply(get_launch_feature)</span><br><span class="line">    feature = pd.merge(feature, pd.DataFrame(lau_feature), on=<span class="string">'user_id'</span>, how=<span class="string">'left'</span>)</span><br><span class="line">    print(<span class="string">'launch表特征提取完毕'</span>)</span><br><span class="line">    </span><br><span class="line">    act = pd.merge(act,reg_day,on=<span class="string">'user_id'</span>, how=<span class="string">'left'</span>)</span><br><span class="line">    act[<span class="string">'max_day'</span>] = np.max(reg[<span class="string">'register_day'</span>])</span><br><span class="line">    act_feature = act.groupby(<span class="string">'user_id'</span>, sort = <span class="keyword">True</span>).apply(get_activity_feature)</span><br><span class="line">    feature = pd.merge(feature, pd.DataFrame(act_feature), on=<span class="string">'user_id'</span>, how=<span class="string">'left'</span>)</span><br><span class="line">    print(<span class="string">'activity表特征提取完毕'</span>)</span><br><span class="line">    </span><br><span class="line">    aut = pd.DataFrame(act.author_id)</span><br><span class="line">    aut[<span class="string">'watched_times_recent_days'</span>] = <span class="number">1</span></span><br><span class="line">    a = aut.groupby(<span class="string">'author_id'</span>).count()</span><br><span class="line">    a_norm = (a.watched_times_recent_days - a.watched_times_recent_days.min()) / (a.watched_times_recent_days.max() - a.watched_times_recent_days.min())</span><br><span class="line">    a[<span class="string">'norm_watched_times_recent_days'</span>] = a_norm</span><br><span class="line">    a.reset_index(inplace=<span class="keyword">True</span>)</span><br><span class="line">    a.rename(columns=&#123;<span class="string">'author_id'</span>:<span class="string">'user_id'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br><span class="line">    feature = pd.merge(feature, a, on=<span class="string">'user_id'</span>, how=<span class="string">'left'</span>)</span><br><span class="line">    </span><br><span class="line">    auth_3 = pd.DataFrame(act.author_id[act.day &gt;= int (np.max(reg[<span class="string">'register_day'</span>]) - <span class="number">2</span>)])</span><br><span class="line">    auth_3[<span class="string">'watched_times_recent_3_days'</span>] = <span class="number">1</span></span><br><span class="line">    auth3 = auth_3.groupby(<span class="string">'author_id'</span>).count()</span><br><span class="line">    auth3.reset_index(inplace=<span class="keyword">True</span>)</span><br><span class="line">    auth3.rename(columns=&#123;<span class="string">'author_id'</span>:<span class="string">'user_id'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br><span class="line">    feature = pd.merge(feature, auth3, on=<span class="string">'user_id'</span>, how=<span class="string">'left'</span>)</span><br><span class="line">    </span><br><span class="line">    auth_5 = pd.DataFrame(act.author_id[act.day &gt;= int (np.max(reg[<span class="string">'register_day'</span>]) - <span class="number">4</span>)])</span><br><span class="line">    auth_5[<span class="string">'watched_times_recent_5_days'</span>] = <span class="number">1</span></span><br><span class="line">    auth5 = auth_5.groupby(<span class="string">'author_id'</span>).count()</span><br><span class="line">    auth5.reset_index(inplace=<span class="keyword">True</span>)</span><br><span class="line">    auth5.rename(columns=&#123;<span class="string">'author_id'</span>:<span class="string">'user_id'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br><span class="line">    feature = pd.merge(feature, auth5, on=<span class="string">'user_id'</span>, how=<span class="string">'left'</span>)</span><br><span class="line">    </span><br><span class="line">    auth_7 = pd.DataFrame(act.author_id[act.day &gt;= int (np.max(reg[<span class="string">'register_day'</span>]) - <span class="number">6</span>)])</span><br><span class="line">    <span class="comment">#下面是后来补加的特征</span></span><br><span class="line">    auth_7[<span class="string">'watched_times_recent_7_days'</span>] = <span class="number">1</span></span><br><span class="line">    auth7 = auth_7.groupby(<span class="string">'author_id'</span>).count()</span><br><span class="line">    auth7.reset_index(inplace=<span class="keyword">True</span>)</span><br><span class="line">    auth7.rename(columns=&#123;<span class="string">'author_id'</span>:<span class="string">'user_id'</span>&#125;, inplace=<span class="keyword">True</span>)</span><br><span class="line">    feature = pd.merge(feature, auth7, on=<span class="string">'user_id'</span>, how=<span class="string">'left'</span>)</span><br><span class="line">    feature[<span class="string">'watched_times_recent_5_3_days'</span>] = feature[<span class="string">'watched_times_recent_5_days'</span>] - feature[<span class="string">'watched_times_recent_3_days'</span>]</span><br><span class="line">    feature[<span class="string">'watched_times_recent_7_5_days'</span>] = feature[<span class="string">'watched_times_recent_7_days'</span>] - feature[<span class="string">'watched_times_recent_5_days'</span>]</span><br><span class="line">    feature[<span class="string">'create_count_in_last_3_5_day'</span>] = feature[<span class="string">'create_count_in_last_5_day'</span>] - feature[<span class="string">'create_count_in_last_3_day'</span>]</span><br><span class="line">    feature[<span class="string">'create_count_in_last_5_7_day'</span>] = feature[<span class="string">'create_count_in_last_7_day'</span>] - feature[<span class="string">'create_count_in_last_5_day'</span>]</span><br><span class="line">    feature[<span class="string">'create_count_in_last_7_9_day'</span>] = feature[<span class="string">'create_count_in_last_9_day'</span>] - feature[<span class="string">'create_count_in_last_7_day'</span>]</span><br><span class="line">    feature[<span class="string">'launch_count_in_3_5_day'</span>] = feature[<span class="string">'launch_count_in_last_5_day'</span>] - feature[<span class="string">'launch_count_in_last_3_day'</span>]</span><br><span class="line">    feature[<span class="string">'launch_count_in_5_7_day'</span>] = feature[<span class="string">'launch_count_in_last_7_day'</span>] - feature[<span class="string">'launch_count_in_last_5_day'</span>]</span><br><span class="line">    feature[<span class="string">'launch_count_in_7_9_day'</span>] = feature[<span class="string">'launch_count_in_last_9_day'</span>] - feature[<span class="string">'launch_count_in_last_7_day'</span>]</span><br><span class="line">    feature[<span class="string">'act_count_in_last_3_5_day'</span>] = feature[<span class="string">'act_count_in_last_5_day'</span>] - feature[<span class="string">'act_count_in_last_3_day'</span>]</span><br><span class="line">    feature[<span class="string">'act_count_in_last_5_7_day'</span>] = feature[<span class="string">'act_count_in_last_7_day'</span>] - feature[<span class="string">'act_count_in_last_5_day'</span>]</span><br><span class="line">    feature[<span class="string">'act_count_in_last_7_9_day'</span>] = feature[<span class="string">'act_count_in_last_9_day'</span>] - feature[<span class="string">'act_count_in_last_7_day'</span>]</span><br><span class="line">    <span class="keyword">return</span> feature</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_data_feature</span><span class="params">()</span>:</span></span><br><span class="line">    one_train_data = get_train_label(one_dataSet_train_path, one_dataSet_test_path)</span><br><span class="line">    one_feature = deal_feature(one_dataSet_train_path, one_train_data[<span class="string">'user_id'</span>])</span><br><span class="line">    one_feature[<span class="string">'label'</span>] = one_train_data[<span class="string">'label'</span>]</span><br><span class="line">    one_feature.to_csv(<span class="string">'data_one_plus.csv'</span>, index=<span class="keyword">False</span>)</span><br><span class="line">    print(<span class="string">'第一组训练数据特征值提取完毕并保存'</span>)</span><br><span class="line"></span><br><span class="line">    two_train_data = get_train_label(two_dataSet_train_path, two_dataSet_test_path)</span><br><span class="line">    two_feature = deal_feature(two_dataSet_train_path, two_train_data[<span class="string">'user_id'</span>])</span><br><span class="line">    two_feature[<span class="string">'label'</span>] = two_train_data[<span class="string">'label'</span>]</span><br><span class="line">    two_feature.to_csv(<span class="string">'data_two_plus.csv'</span>, index=<span class="keyword">False</span>)</span><br><span class="line">    print(<span class="string">'第二组训练数据特征值提取完毕'</span>)</span><br><span class="line">    </span><br><span class="line">    train_feature = pd.concat([one_feature, two_feature])</span><br><span class="line">    train_feature.to_csv(<span class="string">'data/train_and_test/train_plus.csv'</span>, index = <span class="keyword">False</span>)</span><br><span class="line">    print(<span class="string">'训练数据存储完毕'</span>)</span><br><span class="line">    </span><br><span class="line">    test_data = get_test(three_dataSet_train_path)</span><br><span class="line">    test_feature = deal_feature(three_dataSet_train_path, test_data[<span class="string">'user_id'</span>])</span><br><span class="line">    test_feature.to_csv(<span class="string">'data/train_and_test/test_plus.csv'</span>, index=<span class="keyword">False</span>)</span><br><span class="line">    print(<span class="string">'测试数据存储完毕'</span>)</span><br><span class="line">get_data_feature()</span><br></pre></td></tr></table></figure>
<p>有点长哈,感兴趣的可以移驾到本人的github,或许jupyter notebook的格式看起来更好一点</p>
<h4 id="三-模型预测"><a href="#三-模型预测" class="headerlink" title="三. 模型预测"></a>三. 模型预测</h4><p>这次比赛使用了lightgbm,好处是速度快,不用归一化,不用处理缺失值,我也试过XGboost,线上提交了一次,效果不太好就没再用了.由于lightgbm我也是第一次接触,对于参数的把控并不好,所以这里的参数应该是没有什么参考意义的.,这里只上部分代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br></pre></td><td class="code"><pre><span class="line">print(<span class="string">'开始处理特征......'</span>)</span><br><span class="line"><span class="comment"># train_path = 'data/train_and_test/train_plus.csv'</span></span><br><span class="line"><span class="comment"># test_path = 'data/train_and_test/test_plus.csv'</span></span><br><span class="line"><span class="comment"># train = pd.read_csv(train_path)</span></span><br><span class="line"><span class="comment"># test = pd.read_csv(test_path)</span></span><br><span class="line">used_feature = [</span><br><span class="line"><span class="string">'create_count_recent_days'</span>,</span><br><span class="line"><span class="comment">#  'create_count_in_last_3_day',</span></span><br><span class="line"><span class="comment">#  'create_count_in_last_5_day',</span></span><br><span class="line"><span class="comment">#  'create_count_in_last_7_day',</span></span><br><span class="line"><span class="comment">#  'create_count_in_last_9_day',</span></span><br><span class="line"> <span class="string">'create_day_mean'</span>,</span><br><span class="line"><span class="comment">#  'create_day_max',</span></span><br><span class="line"><span class="comment">#  'create_day_min',</span></span><br><span class="line"> <span class="string">'create_day_max_sub_min'</span>,</span><br><span class="line"> <span class="string">'create_day_std'</span>,</span><br><span class="line"> <span class="string">'create_day_var'</span>,</span><br><span class="line"> <span class="string">'create_day_skew'</span>,</span><br><span class="line"> <span class="string">'create_day_kur'</span>,</span><br><span class="line"> <span class="string">'last_day_cut_max_day'</span>,</span><br><span class="line"> <span class="string">'first_day_cut_register_day'</span>,</span><br><span class="line"> <span class="string">'max_create_times_one_day'</span>,</span><br><span class="line"> <span class="string">'create_day_diff_mean'</span>,</span><br><span class="line"> <span class="string">'create_day_diff_max'</span>,</span><br><span class="line"> <span class="string">'create_day_diff_min'</span>,</span><br><span class="line"> <span class="string">'create_day_diff_std'</span>,</span><br><span class="line"> <span class="string">'create_day_diff_var'</span>,</span><br><span class="line"> <span class="string">'register_day'</span>,</span><br><span class="line"> <span class="string">'register_type'</span>,</span><br><span class="line"> <span class="string">'device_type'</span>,</span><br><span class="line"> <span class="string">'register_day_cut_max_day'</span>,</span><br><span class="line"> <span class="string">'launch_count_recent_days'</span>,</span><br><span class="line"> <span class="string">'reg_now_diff'</span>,</span><br><span class="line"><span class="comment">#  'launch_count_in_last_3_day',</span></span><br><span class="line"><span class="comment">#  'launch_count_in_last_5_day',</span></span><br><span class="line"><span class="comment">#  'launch_count_in_last_7_day',</span></span><br><span class="line"><span class="comment">#  'launch_count_in_last_9_day',</span></span><br><span class="line"><span class="comment">#  'launch_day_mean',</span></span><br><span class="line"><span class="comment">#  'launch_day_max',</span></span><br><span class="line"><span class="comment">#  'launch_day_min',</span></span><br><span class="line"> <span class="string">'launch_day_max_sub_min'</span>,</span><br><span class="line"> <span class="string">'launch_day_std'</span>,</span><br><span class="line"> <span class="string">'launch_day_var'</span>,</span><br><span class="line"> <span class="string">'launch_day_kur'</span>,</span><br><span class="line"> <span class="string">'launch_day_skew'</span>,</span><br><span class="line"> <span class="string">'last_launch_day_cut_max_day'</span>,</span><br><span class="line"> <span class="string">'first_launch_day_cut_register_day'</span>,</span><br><span class="line"><span class="comment">#  'launch_mean_cut_max_day',</span></span><br><span class="line"> <span class="string">'max_launch_times_one_day'</span>,</span><br><span class="line"> <span class="string">'launch_day_diff_mean'</span>,</span><br><span class="line"> <span class="string">'launch_day_diff_max'</span>,</span><br><span class="line"> <span class="string">'launch_day_diff_min'</span>,</span><br><span class="line"> <span class="string">'launch_day_diff_std'</span>,</span><br><span class="line"> <span class="string">'launch_day_diff_var'</span>,</span><br><span class="line"><span class="comment">#  'act_count_in_last_3_day',</span></span><br><span class="line"><span class="comment">#  'act_count_in_last_5_day',</span></span><br><span class="line"><span class="comment">#  'act_count_in_last_7_day',</span></span><br><span class="line"><span class="comment">#  'act_count_in_last_9_day',</span></span><br><span class="line"> <span class="string">'activity_count'</span>,</span><br><span class="line"> <span class="string">'activity_day_mean'</span>,</span><br><span class="line"><span class="comment">#  'activity_day_max',</span></span><br><span class="line"><span class="comment">#  'activity_day_min',</span></span><br><span class="line"> <span class="string">'activity_day_std'</span>,</span><br><span class="line"> <span class="string">'activity_day_var'</span>,</span><br><span class="line"> <span class="string">'activity_day_ske'</span>,</span><br><span class="line"> <span class="string">'activity_day_kur'</span>,</span><br><span class="line"> <span class="string">'activity_day_max_cut_min'</span>,</span><br><span class="line"> <span class="string">'activity_day_cut_max_day'</span>,</span><br><span class="line"> <span class="string">'activity_day_cut_register_day'</span>,</span><br><span class="line"> <span class="string">'act_sub_register'</span>,</span><br><span class="line"> <span class="string">'0_page_count'</span>,</span><br><span class="line"> <span class="string">'1_page_count'</span>,</span><br><span class="line"> <span class="string">'2_page_count'</span>,</span><br><span class="line"> <span class="string">'3_page_count'</span>,</span><br><span class="line"> <span class="string">'4_page_count'</span>,</span><br><span class="line"><span class="comment">#  '0_page_count_in_3_days',</span></span><br><span class="line"><span class="comment">#  '1_page_count_in_3_days',</span></span><br><span class="line"><span class="comment">#  '2_page_count_in_3_days',</span></span><br><span class="line"><span class="comment">#  '3_page_count_in_3_days',</span></span><br><span class="line"><span class="comment">#  '4_page_count_in_3_days',</span></span><br><span class="line"><span class="comment">#  '0_page_count_in_5_days',</span></span><br><span class="line"><span class="comment">#  '1_page_count_in_5_days',</span></span><br><span class="line"><span class="comment">#  '2_page_count_in_5_days',</span></span><br><span class="line"><span class="comment">#  '3_page_count_in_5_days',</span></span><br><span class="line"><span class="comment">#  '4_page_count_in_5_days',</span></span><br><span class="line"><span class="comment">#  '0_page_count_in_7_days',</span></span><br><span class="line"><span class="comment">#  '1_page_count_in_7_days',</span></span><br><span class="line"><span class="comment">#  '2_page_count_in_7_days',</span></span><br><span class="line"><span class="comment">#  '3_page_count_in_7_days',</span></span><br><span class="line"><span class="comment">#  '4_page_count_in_7_days',</span></span><br><span class="line"> <span class="string">'0_page_count_div_sum'</span>,</span><br><span class="line"> <span class="string">'1_page_count_div_sum'</span>,</span><br><span class="line"> <span class="string">'2_page_count_div_sum'</span>,</span><br><span class="line"> <span class="string">'3_page_count_div_sum'</span>,</span><br><span class="line"> <span class="string">'4_page_count_div_sum'</span>,</span><br><span class="line"> <span class="string">'0_action_count'</span>,</span><br><span class="line"> <span class="string">'1_action_count'</span>,</span><br><span class="line"> <span class="string">'2_action_count'</span>,</span><br><span class="line"> <span class="string">'3_action_count'</span>,</span><br><span class="line"> <span class="string">'4_action_count'</span>,</span><br><span class="line"> <span class="string">'5_action_count'</span>,</span><br><span class="line"><span class="comment">#  '0_action_count_in_3_days',</span></span><br><span class="line"><span class="comment">#  '1_action_count_in_3_days',</span></span><br><span class="line"><span class="comment">#  '2_action_count_in_3_days',</span></span><br><span class="line"><span class="comment">#  '3_action_count_in_3_days',</span></span><br><span class="line"><span class="comment">#  '4_action_count_in_3_days',</span></span><br><span class="line"><span class="comment">#  '5_action_count_in_3_days',</span></span><br><span class="line"><span class="comment">#  '0_action_count_in_5_days',</span></span><br><span class="line"><span class="comment">#  '1_action_count_in_5_days',</span></span><br><span class="line"><span class="comment">#  '2_action_count_in_5_days',</span></span><br><span class="line"><span class="comment">#  '3_action_count_in_5_days',</span></span><br><span class="line"><span class="comment">#  '4_action_count_in_5_days',</span></span><br><span class="line"><span class="comment">#  '5_action_count_in_5_days',</span></span><br><span class="line"><span class="comment">#  '0_action_count_in_7_days',</span></span><br><span class="line"><span class="comment">#  '1_action_count_in_7_days',</span></span><br><span class="line"><span class="comment">#  '2_action_count_in_7_days',</span></span><br><span class="line"><span class="comment">#  '3_action_count_in_7_days',</span></span><br><span class="line"><span class="comment">#  '4_action_count_in_7_days',</span></span><br><span class="line"><span class="comment">#  '5_action_count_in_7_days',</span></span><br><span class="line"> <span class="string">'0_action_count_div_sum'</span>,</span><br><span class="line"> <span class="string">'1_action_count_div_sum'</span>,</span><br><span class="line"> <span class="string">'2_action_count_div_sum'</span>,</span><br><span class="line"> <span class="string">'3_action_count_div_sum'</span>,</span><br><span class="line"> <span class="string">'4_action_count_div_sum'</span>,</span><br><span class="line"> <span class="string">'5_action_count_div_sum'</span>,</span><br><span class="line"> <span class="string">'max_act_times_per_day'</span>,</span><br><span class="line"> <span class="string">'max_hot_vid'</span>,</span><br><span class="line"> <span class="string">'max_hot_auth'</span>,</span><br><span class="line"> <span class="string">'mean_hot_vid'</span>,</span><br><span class="line"> <span class="string">'mean_hot_auth'</span>,</span><br><span class="line"><span class="comment">#  'std_hot_vid',</span></span><br><span class="line"><span class="comment">#  'kur_hot_vid',</span></span><br><span class="line"><span class="comment">#  'min_hot_vid',</span></span><br><span class="line"><span class="comment">#  'min_hot_auth',</span></span><br><span class="line"><span class="comment">#  'sum_hot_vid',</span></span><br><span class="line"><span class="comment">#  'sum_hot_auth',</span></span><br><span class="line"><span class="comment">#  'std_hot_auth',</span></span><br><span class="line"><span class="comment">#  'kur_hot_auth',</span></span><br><span class="line"> <span class="string">'norm_max_hot_vid'</span>,</span><br><span class="line"> <span class="string">'norm_max_hot_auth'</span>,</span><br><span class="line"> <span class="string">'norm_mean_hot_vid'</span>,</span><br><span class="line"> <span class="string">'norm_mean_hot_auth'</span>,</span><br><span class="line"> <span class="string">'norm_std_hot_vid'</span>,</span><br><span class="line"> <span class="string">'norm_kur_hot_vid'</span>,</span><br><span class="line"> <span class="string">'norm_min_hot_vid'</span>,</span><br><span class="line"> <span class="string">'norm_min_hot_auth'</span>,</span><br><span class="line"> <span class="string">'norm_sum_hot_vid'</span>,</span><br><span class="line"> <span class="string">'norm_sum_hot_auth'</span>,</span><br><span class="line"> <span class="string">'norm_std_hot_auth'</span>,</span><br><span class="line"> <span class="string">'norm_kur_hot_auth'</span>,</span><br><span class="line"> <span class="string">'activity_day_diff_mean'</span>,</span><br><span class="line"> <span class="string">'activity_day_diff_max'</span>,</span><br><span class="line"> <span class="string">'activity_day_diff_min'</span>,</span><br><span class="line"> <span class="string">'activity_day_diff_std'</span>,</span><br><span class="line"> <span class="string">'activity_day_diff_var'</span>,</span><br><span class="line"> <span class="string">'activity_day_diff_ske'</span>,</span><br><span class="line"> <span class="string">'activity_day_diff_kur'</span>,</span><br><span class="line"> <span class="string">'watched_times_recent_days'</span>,</span><br><span class="line"> <span class="string">'norm_watched_times_recent_days'</span>,</span><br><span class="line"><span class="comment">#  'watched_times_recent_3_days',</span></span><br><span class="line"><span class="comment">#  'watched_times_recent_5_days',</span></span><br><span class="line"><span class="comment">#  'watched_times_recent_7_days',</span></span><br><span class="line"><span class="comment">#  'watched_times_recent_5_3_days',</span></span><br><span class="line"><span class="comment">#  'watched_times_recent_7_5_days',</span></span><br><span class="line"><span class="comment">#  'create_count_in_last_3_5_day',</span></span><br><span class="line"><span class="comment">#  'create_count_in_last_5_7_day',</span></span><br><span class="line"><span class="comment">#  'create_count_in_last_7_9_day',</span></span><br><span class="line"><span class="comment">#  'launch_count_in_3_5_day',</span></span><br><span class="line"><span class="comment">#  'launch_count_in_5_7_day',</span></span><br><span class="line"><span class="comment">#  'launch_count_in_7_9_day',</span></span><br><span class="line"><span class="comment">#  'act_count_in_last_3_5_day',</span></span><br><span class="line"><span class="comment">#  'act_count_in_last_5_7_day',</span></span><br><span class="line"><span class="comment">#  'act_count_in_last_7_9_day',</span></span><br><span class="line">]</span><br><span class="line">used_feature = np.array(used_feature)</span><br><span class="line"><span class="comment"># print(used_feature)</span></span><br><span class="line"><span class="comment"># importance_feature = [2, 3, 6, 7, 11, 13, 14, 21, 22, 23, 25, 27, 28, 29, 30, 31, 32, 33, 35, 36, 37, 41, 42, 43, 44, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 58, 62, 63, 64, 66, 67, 68, 69, 70, 72, 73, 74, 75, 77, 78, 79, 80, 81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 93, 94, 95, 99, 101, 105, 106, 108, 111, 112, 113, 114, 115, 116, 117, 118, 119, 120, 121, 122, 123, 125, 126, 127, 128, 129, 131, 132, 133, 134, 135, 138, 139, 140, 141, 142, 144, 145, 147, 148, 151, 152, 153, 162, 163]</span></span><br><span class="line"><span class="comment"># used_feature = used_feature[np.array(importance_feature)]</span></span><br><span class="line">print(used_feature)</span><br><span class="line"><span class="comment"># train_feature = train[used_feature]</span></span><br><span class="line"><span class="comment"># test_feature = test[used_feature]</span></span><br><span class="line"><span class="comment"># label = train['label']</span></span><br><span class="line"></span><br><span class="line">train = pd.read_csv(<span class="string">'data_one_plus.csv'</span>)</span><br><span class="line">test2 = pd.read_csv(<span class="string">'data_two_plus.csv'</span>)</span><br><span class="line">X_train = train[used_feature]</span><br><span class="line">Y_train = train[<span class="string">'label'</span>]</span><br><span class="line"></span><br><span class="line">X_test = test2[used_feature]</span><br><span class="line">Y_test= test2[<span class="string">'label'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># X_test1 = test2[used_feature].head(10000)</span></span><br><span class="line"><span class="comment"># Y_test1 = test2['label'].head(10000)</span></span><br><span class="line"><span class="comment"># X_test2 = test2[used_feature].tail(27332)</span></span><br><span class="line"><span class="comment"># Y_test2 = test2['label'].tail(27332)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 切分训练</span></span><br><span class="line"><span class="comment"># X_train, X_test, Y_train, Y_test = model_selection.train_test_split(train_feature, label, test_size=0.2,random_state=104)</span></span><br><span class="line"><span class="comment"># train_feature = X_train</span></span><br><span class="line"><span class="comment"># label = Y_train</span></span><br><span class="line"></span><br><span class="line">print(<span class="string">'特征处理完毕......'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'载入数据......'</span>)</span><br><span class="line"><span class="comment"># lgb_train = lgb.Dataset(train_feature, label)</span></span><br><span class="line"><span class="comment"># lgb_eval = lgb.Dataset(X_test, Y_test, reference=lgb_train,free_raw_data=False)</span></span><br><span class="line">lgb_train = lgb.Dataset(X_train, Y_train)</span><br><span class="line">lgb_eval = lgb.Dataset(X_test, Y_test, reference=lgb_train,free_raw_data=<span class="keyword">False</span>)</span><br><span class="line"><span class="comment">### 设置初始参数--不含交叉验证参数</span></span><br><span class="line">print(<span class="string">'设置参数'</span>)</span><br><span class="line">params = &#123;</span><br><span class="line">    <span class="string">'boosting_type'</span>: <span class="string">'gbdt'</span>,</span><br><span class="line">    <span class="string">'objective'</span>: <span class="string">'binary'</span>,</span><br><span class="line">    <span class="string">'metric'</span>: &#123;<span class="string">'auc'</span>,<span class="string">'binary_logloss'</span>&#125;,</span><br><span class="line">    <span class="string">'num_leaves'</span>:<span class="number">12</span>,</span><br><span class="line"><span class="comment">#     'random_state' : 1053,</span></span><br><span class="line">    <span class="string">'early_stopping_round'</span>:<span class="number">10</span>,</span><br><span class="line"><span class="comment">#     'learning_rate': 0.1,</span></span><br><span class="line"><span class="comment">#     'min_data_in_leaf':300,</span></span><br><span class="line"><span class="comment">#     'bagging_fraction':1,</span></span><br><span class="line"><span class="comment">#     'lambda_l1': 1,    </span></span><br><span class="line"><span class="comment">#     'lambda_l2': 0.01,  # 越小l2正则程度越高  </span></span><br><span class="line">&#125;</span><br><span class="line">gbm = lgb.train(params,</span><br><span class="line">                lgb_train,</span><br><span class="line">                num_boost_round=<span class="number">1118</span>,</span><br><span class="line">                valid_sets=lgb_eval,</span><br><span class="line">                </span><br><span class="line">                )</span><br><span class="line">gbm.save_model(<span class="string">'model/lgb_model.txt'</span>)</span><br><span class="line"></span><br><span class="line">temp = gbm.predict(X_test)</span><br><span class="line">temp[temp&gt;=<span class="number">0.44</span>]=<span class="number">1</span></span><br><span class="line">temp[temp&lt;<span class="number">0.44</span>]=<span class="number">0</span></span><br><span class="line">print(<span class="string">'结果：'</span> + str(sklearn.metrics.f1_score(Y_test, temp)))</span><br><span class="line"><span class="comment"># print('召回率结果：' + str(sklearn.metrics.recall_score(Y_test, temp)))</span></span><br><span class="line"><span class="comment"># print('精确率结果：' + str(sklearn.metrics.precision_score(Y_test, temp)))</span></span><br><span class="line">print(<span class="string">'特征重要性：'</span>+ str(list(gbm.feature_importance())))</span><br><span class="line"></span><br><span class="line"><span class="comment">#交叉验证调参</span></span><br><span class="line">params = &#123;</span><br><span class="line">          <span class="string">'boosting_type'</span>: <span class="string">'gbdt'</span>,</span><br><span class="line">          <span class="string">'objective'</span>: <span class="string">'binary'</span>,</span><br><span class="line">          <span class="string">'metric'</span>: <span class="string">'binary_logloss'</span>,</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">### 交叉验证(调参)</span></span><br><span class="line">print(<span class="string">'交叉验证'</span>)</span><br><span class="line">min_merror = float(<span class="string">'Inf'</span>)</span><br><span class="line">best_params = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># 准确率</span></span><br><span class="line">print(<span class="string">"调参1：提高准确率"</span>)</span><br><span class="line"><span class="keyword">for</span> num_leaves <span class="keyword">in</span> range(<span class="number">4</span>,<span class="number">100</span>,<span class="number">2</span>):</span><br><span class="line">    <span class="keyword">for</span> max_depth <span class="keyword">in</span> range(<span class="number">2</span>,<span class="number">8</span>,<span class="number">1</span>):</span><br><span class="line">        params[<span class="string">'num_leaves'</span>] = num_leaves</span><br><span class="line">        params[<span class="string">'max_depth'</span>] = max_depth</span><br><span class="line"></span><br><span class="line">        cv_results = lgb.cv(</span><br><span class="line">                            params,</span><br><span class="line">                            lgb_train,</span><br><span class="line">                            seed=<span class="number">1012</span>,</span><br><span class="line">                            nfold=<span class="number">3</span>,</span><br><span class="line">                            metrics=[<span class="string">'binary_error'</span>],</span><br><span class="line">                            early_stopping_rounds=<span class="number">10</span>,</span><br><span class="line">                            verbose_eval=<span class="keyword">True</span></span><br><span class="line">                            )</span><br><span class="line"></span><br><span class="line">        mean_merror = pd.Series(cv_results[<span class="string">'binary_error-mean'</span>]).min()</span><br><span class="line">        boost_rounds = pd.Series(cv_results[<span class="string">'binary_error-mean'</span>]).argmin()</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> mean_merror &lt; min_merror:</span><br><span class="line">            min_merror = mean_merror</span><br><span class="line">            best_params[<span class="string">'num_leaves'</span>] = num_leaves</span><br><span class="line">            best_params[<span class="string">'max_depth'</span>] = max_depth</span><br><span class="line"></span><br><span class="line">params[<span class="string">'num_leaves'</span>] = best_params[<span class="string">'num_leaves'</span>]</span><br><span class="line">params[<span class="string">'max_depth'</span>] = best_params[<span class="string">'max_depth'</span>]</span><br></pre></td></tr></table></figure>
<h4 id="四-赛后总结"><a href="#四-赛后总结" class="headerlink" title="四.赛后总结"></a>四.赛后总结</h4><p>参加这个比赛对我个人来说有重大意义,毕竟是第一个大部分工作都由自己完成的比赛,虽然前期借鉴了群友的数据划分的策略,但是从后面的提特征和调参是实打实自己干的,这个比赛有些槽点,就是用f1作为评分准则,使得不能单纯以提高准确率为目标,最后还得考量提交的用户的数量,就变成了调试阈值的比赛.</p>

  </section>
</article>

  <div class="sharing grid">
  <section class="profile grid-item grid">
    <img class="avatar" src="http://7xrcp8.com1.z0.glb.clouddn.com/avatar.png" alt="avatar" />
    <div class="grid-item">
      <p class="title"> lyyourc </p>
      <p class="subtitle"> You Are The JavaScript In My HTML </p>
    <div>
  </section>

  <section class="share-btns">
    <!-- <p> share it if you like it~ </p> -->
    <a
  class="twitter-share-button"
  data-size="large"
  data-via="DrakeLeung"
  href="https://twitter.com/intent/tweet?text=这个比赛是我除了kaggle两个练手比赛"
>
  Tweet
</a>

<script>
  window.twttr = (function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0],
    t = window.twttr || {};
  if (d.getElementById(id)) return t;
  js = d.createElement(s);
  js.id = id;
  js.src = "https://platform.twitter.com/widgets.js";
  js.async = true;
  fjs.parentNode.insertBefore(js, fjs);

  t._e = [];
  t.ready = function(f) {
    t._e.push(f);
  };

  return t;
}(document, "script", "twitter-wjs"));
</script>

  </section>
</div>


  
    
<section class="article-comment">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>

<script>
  var disqus_shortname = 'drakeleung';
  
  var disqus_url = '//harold.me/2018/07/03/科赛-大数据挑战赛总结/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


  
</main>

</body>
</html>
